'use strict';

var chunkVTVCMIAI_cjs = require('../chunk-VTVCMIAI.cjs');
var zod = require('zod');

// src/processor-provider/types.ts
var ALL_PROCESSOR_PHASES = [
  "processInput",
  "processInputStep",
  "processOutputStream",
  "processOutputResult",
  "processOutputStep"
];

// src/processor-provider/phase-filtered-processor.ts
var PhaseFilteredProcessor = class {
  id;
  name;
  description;
  processorIndex;
  #inner;
  #enabledPhases;
  constructor(inner, enabledPhases) {
    this.#inner = inner;
    this.#enabledPhases = new Set(enabledPhases);
    this.id = inner.id;
    this.name = inner.name;
    this.description = inner.description;
    if (this.#enabledPhases.has("processInput") && inner.processInput) {
      this.processInput = inner.processInput.bind(inner);
    }
    if (this.#enabledPhases.has("processInputStep") && inner.processInputStep) {
      this.processInputStep = inner.processInputStep.bind(inner);
    }
    if (this.#enabledPhases.has("processOutputStream") && inner.processOutputStream) {
      this.processOutputStream = inner.processOutputStream.bind(inner);
    }
    if (this.#enabledPhases.has("processOutputResult") && inner.processOutputResult) {
      this.processOutputResult = inner.processOutputResult.bind(inner);
    }
    if (this.#enabledPhases.has("processOutputStep") && inner.processOutputStep) {
      this.processOutputStep = inner.processOutputStep.bind(inner);
    }
  }
  processInput;
  processInputStep;
  processOutputStream;
  processOutputResult;
  processOutputStep;
  __registerMastra(mastra) {
    this.#inner.__registerMastra?.(mastra);
  }
};
var structuredOutputOptionsSchema = zod.z.object({ jsonPromptInjection: zod.z.boolean().optional() }).optional();
var providerOptionsSchema = zod.z.record(zod.z.string(), zod.z.any()).optional();
var unicodeNormalizerProvider = {
  info: {
    id: "unicode-normalizer",
    name: "Unicode Normalizer",
    description: "Normalizes Unicode text by stripping control characters, collapsing whitespace, and trimming."
  },
  configSchema: zod.z.object({
    stripControlChars: zod.z.boolean().optional(),
    preserveEmojis: zod.z.boolean().optional(),
    collapseWhitespace: zod.z.boolean().optional(),
    trim: zod.z.boolean().optional()
  }),
  availablePhases: ["processInput"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.UnicodeNormalizer(config);
  }
};
var tokenLimiterProvider = {
  info: {
    id: "token-limiter",
    name: "Token Limiter",
    description: "Limits the number of tokens in messages, supporting both input filtering and output truncation."
  },
  configSchema: zod.z.object({
    limit: zod.z.number(),
    strategy: zod.z.enum(["truncate", "abort"]).optional(),
    countMode: zod.z.enum(["cumulative", "part"]).optional()
  }),
  availablePhases: ["processInput", "processOutputStream", "processOutputResult"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.TokenLimiterProcessor(
      config
    );
  }
};
var toolCallFilterProvider = {
  info: {
    id: "tool-call-filter",
    name: "Tool Call Filter",
    description: "Filters out tool calls and results from messages, optionally targeting specific tools."
  },
  configSchema: zod.z.object({
    exclude: zod.z.array(zod.z.string()).optional()
  }),
  availablePhases: ["processInput"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.ToolCallFilter(config);
  }
};
var batchPartsProvider = {
  info: {
    id: "batch-parts",
    name: "Batch Parts",
    description: "Batches multiple stream parts together to reduce stream overhead."
  },
  configSchema: zod.z.object({
    batchSize: zod.z.number().optional(),
    maxWaitTime: zod.z.number().optional(),
    emitOnNonText: zod.z.boolean().optional()
  }),
  availablePhases: ["processOutputStream"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.BatchPartsProcessor(config);
  }
};
var moderationProvider = {
  info: {
    id: "moderation",
    name: "Moderation",
    description: "Evaluates content against configurable moderation categories for content safety."
  },
  configSchema: zod.z.object({
    model: zod.z.string(),
    categories: zod.z.array(zod.z.string()).optional(),
    threshold: zod.z.number().optional(),
    strategy: zod.z.enum(["block", "warn", "filter"]).optional(),
    instructions: zod.z.string().optional(),
    includeScores: zod.z.boolean().optional(),
    chunkWindow: zod.z.number().optional(),
    structuredOutputOptions: structuredOutputOptionsSchema,
    providerOptions: providerOptionsSchema
  }),
  availablePhases: ["processInput", "processOutputResult", "processOutputStream"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.ModerationProcessor(config);
  }
};
var promptInjectionDetectorProvider = {
  info: {
    id: "prompt-injection-detector",
    name: "Prompt Injection Detector",
    description: "Identifies and handles prompt injection attacks, jailbreaks, and data exfiltration attempts."
  },
  configSchema: zod.z.object({
    model: zod.z.string(),
    detectionTypes: zod.z.array(zod.z.string()).optional(),
    threshold: zod.z.number().optional(),
    strategy: zod.z.enum(["block", "warn", "filter", "rewrite"]).optional(),
    instructions: zod.z.string().optional(),
    includeScores: zod.z.boolean().optional(),
    structuredOutputOptions: structuredOutputOptionsSchema,
    providerOptions: providerOptionsSchema
  }),
  availablePhases: ["processInput"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.PromptInjectionDetector(config);
  }
};
var piiDetectorProvider = {
  info: {
    id: "pii-detector",
    name: "PII Detector",
    description: "Identifies and redacts personally identifiable information for privacy compliance."
  },
  configSchema: zod.z.object({
    model: zod.z.string(),
    detectionTypes: zod.z.array(zod.z.string()).optional(),
    threshold: zod.z.number().optional(),
    strategy: zod.z.enum(["block", "warn", "filter", "redact"]).optional(),
    redactionMethod: zod.z.enum(["mask", "hash", "remove", "placeholder"]).optional(),
    instructions: zod.z.string().optional(),
    includeDetections: zod.z.boolean().optional(),
    preserveFormat: zod.z.boolean().optional(),
    structuredOutputOptions: structuredOutputOptionsSchema,
    providerOptions: providerOptionsSchema
  }),
  availablePhases: ["processInput"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.PIIDetector(config);
  }
};
var languageDetectorProvider = {
  info: {
    id: "language-detector",
    name: "Language Detector",
    description: "Detects the language of input text and optionally translates it to a target language."
  },
  configSchema: zod.z.object({
    model: zod.z.string(),
    targetLanguages: zod.z.array(zod.z.string()),
    threshold: zod.z.number().optional(),
    strategy: zod.z.enum(["detect", "translate", "block", "warn"]).optional(),
    preserveOriginal: zod.z.boolean().optional(),
    instructions: zod.z.string().optional(),
    minTextLength: zod.z.number().optional(),
    includeDetectionDetails: zod.z.boolean().optional(),
    translationQuality: zod.z.enum(["speed", "quality", "balanced"]).optional(),
    providerOptions: providerOptionsSchema
  }),
  availablePhases: ["processInput"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.LanguageDetector(config);
  }
};
var systemPromptScrubberProvider = {
  info: {
    id: "system-prompt-scrubber",
    name: "System Prompt Scrubber",
    description: "Detects and removes system prompt leakage from model outputs."
  },
  configSchema: zod.z.object({
    model: zod.z.string(),
    strategy: zod.z.enum(["block", "warn", "filter", "redact"]).optional(),
    customPatterns: zod.z.array(zod.z.string()).optional(),
    includeDetections: zod.z.boolean().optional(),
    instructions: zod.z.string().optional(),
    redactionMethod: zod.z.enum(["mask", "placeholder", "remove"]).optional(),
    placeholderText: zod.z.string().optional(),
    structuredOutputOptions: structuredOutputOptionsSchema
  }),
  availablePhases: ["processOutputStream", "processOutputResult"],
  createProcessor(config) {
    return new chunkVTVCMIAI_cjs.SystemPromptScrubber(config);
  }
};
var BUILT_IN_PROCESSOR_PROVIDERS = {
  "unicode-normalizer": unicodeNormalizerProvider,
  "token-limiter": tokenLimiterProvider,
  "tool-call-filter": toolCallFilterProvider,
  "batch-parts": batchPartsProvider,
  moderation: moderationProvider,
  "prompt-injection-detector": promptInjectionDetectorProvider,
  "pii-detector": piiDetectorProvider,
  "language-detector": languageDetectorProvider,
  "system-prompt-scrubber": systemPromptScrubberProvider
};

exports.ALL_PROCESSOR_PHASES = ALL_PROCESSOR_PHASES;
exports.BUILT_IN_PROCESSOR_PROVIDERS = BUILT_IN_PROCESSOR_PROVIDERS;
exports.PhaseFilteredProcessor = PhaseFilteredProcessor;
exports.batchPartsProvider = batchPartsProvider;
exports.languageDetectorProvider = languageDetectorProvider;
exports.moderationProvider = moderationProvider;
exports.piiDetectorProvider = piiDetectorProvider;
exports.promptInjectionDetectorProvider = promptInjectionDetectorProvider;
exports.systemPromptScrubberProvider = systemPromptScrubberProvider;
exports.tokenLimiterProvider = tokenLimiterProvider;
exports.toolCallFilterProvider = toolCallFilterProvider;
exports.unicodeNormalizerProvider = unicodeNormalizerProvider;
//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map