{"version":3,"sources":["../src/server/schemas/mcp-client-versions.ts","../src/server/handlers/mcp-client-versions.ts"],"names":["listVersionsQuerySchema","compareVersionsQuerySchema","createVersionBodySchema","z","createListVersionsResponseSchema","activateVersionResponseSchema","deleteVersionResponseSchema","createCompareVersionsResponseSchema","createRoute","HTTPException","handleError","extractConfigFromVersion","MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS","calculateChangedFields","createVersionWithRetry","enforceRetentionLimit","computeVersionDiffs"],"mappings":"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","file":"chunk-BD254TQA.cjs","sourcesContent":["import z from 'zod';\nimport {\n  listVersionsQuerySchema,\n  compareVersionsQuerySchema,\n  createVersionBodySchema,\n  activateVersionResponseSchema,\n  deleteVersionResponseSchema,\n  versionDiffEntrySchema,\n  createListVersionsResponseSchema,\n  createCompareVersionsResponseSchema,\n} from './version-common';\n\n// Re-export shared schemas under domain-specific names\nexport const listMCPClientVersionsQuerySchema = listVersionsQuerySchema;\nexport const compareMCPClientVersionsQuerySchema = compareVersionsQuerySchema;\nexport const createMCPClientVersionBodySchema = createVersionBodySchema;\n\n// ============================================================================\n// Path Parameter Schemas\n// ============================================================================\n\nexport const mcpClientVersionPathParams = z.object({\n  mcpClientId: z.string().describe('Unique identifier for the stored MCP client'),\n});\n\nexport const mcpClientVersionIdPathParams = z.object({\n  mcpClientId: z.string().describe('Unique identifier for the stored MCP client'),\n  versionId: z.string().describe('Unique identifier for the version (UUID)'),\n});\n\n// ============================================================================\n// Response Schemas\n// ============================================================================\n\nconst mcpServerConfigSchema = z.object({\n  type: z.enum(['stdio', 'http']),\n  command: z.string().optional(),\n  args: z.array(z.string()).optional(),\n  env: z.record(z.string(), z.string()).optional(),\n  url: z.string().optional(),\n  timeout: z.number().optional(),\n});\n\nexport const mcpClientVersionSchema = z.object({\n  id: z.string().describe('Unique identifier for the version (UUID)'),\n  mcpClientId: z.string().describe('ID of the MCP client this version belongs to'),\n  versionNumber: z.number().describe('Sequential version number (1, 2, 3, ...)'),\n  // Snapshot config fields\n  name: z.string().describe('Name of the MCP client'),\n  description: z.string().optional().describe('Description of the MCP client'),\n  servers: z.record(z.string(), mcpServerConfigSchema),\n  // Version metadata\n  changedFields: z.array(z.string()).optional().describe('Array of field names that changed from the previous version'),\n  changeMessage: z.string().optional().describe('Optional message describing the changes'),\n  createdAt: z.coerce.date().describe('When this version was created'),\n});\n\nexport const listMCPClientVersionsResponseSchema = createListVersionsResponseSchema(mcpClientVersionSchema);\n\nexport const getMCPClientVersionResponseSchema = mcpClientVersionSchema;\n\nexport const createMCPClientVersionResponseSchema = mcpClientVersionSchema.partial().merge(\n  z.object({\n    id: z.string(),\n    mcpClientId: z.string(),\n    versionNumber: z.number(),\n    createdAt: z.coerce.date(),\n  }),\n);\n\nexport const activateMCPClientVersionResponseSchema = activateVersionResponseSchema;\n\nexport const restoreMCPClientVersionResponseSchema = mcpClientVersionSchema;\n\nexport const deleteMCPClientVersionResponseSchema = deleteVersionResponseSchema;\n\nexport const compareMCPClientVersionsResponseSchema = createCompareVersionsResponseSchema(mcpClientVersionSchema);\n\nexport { versionDiffEntrySchema };\n","import { HTTPException } from '../http-exception';\nimport {\n  mcpClientVersionPathParams,\n  mcpClientVersionIdPathParams,\n  listMCPClientVersionsQuerySchema,\n  createMCPClientVersionBodySchema,\n  compareMCPClientVersionsQuerySchema,\n  listMCPClientVersionsResponseSchema,\n  getMCPClientVersionResponseSchema,\n  createMCPClientVersionResponseSchema,\n  activateMCPClientVersionResponseSchema,\n  restoreMCPClientVersionResponseSchema,\n  deleteMCPClientVersionResponseSchema,\n  compareMCPClientVersionsResponseSchema,\n} from '../schemas/mcp-client-versions';\nimport { createRoute } from '../server-adapter/routes/route-builder';\n\nimport { handleError } from './error';\nimport {\n  extractConfigFromVersion,\n  calculateChangedFields,\n  computeVersionDiffs,\n  createVersionWithRetry,\n  enforceRetentionLimit,\n  MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n} from './version-helpers';\nimport type { VersionedStoreInterface } from './version-helpers';\n\n/**\n * GET /stored/mcp-clients/:mcpClientId/versions - List all versions for an MCP client\n */\nexport const LIST_MCP_CLIENT_VERSIONS_ROUTE = createRoute({\n  method: 'GET',\n  path: '/stored/mcp-clients/:mcpClientId/versions',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionPathParams,\n  queryParamSchema: listMCPClientVersionsQuerySchema,\n  responseSchema: listMCPClientVersionsResponseSchema,\n  summary: 'List MCP client versions',\n  description: 'Returns a paginated list of all versions for a stored MCP client',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, page, perPage, orderBy }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const mcpClient = await mcpClientStore.getById(mcpClientId);\n      if (!mcpClient) {\n        throw new HTTPException(404, { message: `MCP client with id ${mcpClientId} not found` });\n      }\n\n      const result = await mcpClientStore.listVersions({\n        mcpClientId,\n        page,\n        perPage,\n        orderBy,\n      });\n\n      return result;\n    } catch (error) {\n      return handleError(error, 'Error listing MCP client versions');\n    }\n  },\n});\n\n/**\n * POST /stored/mcp-clients/:mcpClientId/versions - Create a new version snapshot\n */\nexport const CREATE_MCP_CLIENT_VERSION_ROUTE = createRoute({\n  method: 'POST',\n  path: '/stored/mcp-clients/:mcpClientId/versions',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionPathParams,\n  bodySchema: createMCPClientVersionBodySchema,\n  responseSchema: createMCPClientVersionResponseSchema,\n  summary: 'Create MCP client version',\n  description: 'Creates a new version snapshot of the current MCP client configuration',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, changeMessage }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const mcpClient = await mcpClientStore.getById(mcpClientId);\n      if (!mcpClient) {\n        throw new HTTPException(404, { message: `MCP client with id ${mcpClientId} not found` });\n      }\n\n      let currentConfig: Record<string, unknown> = {};\n      if (mcpClient.activeVersionId) {\n        const activeVersion = await mcpClientStore.getVersion(mcpClient.activeVersionId);\n        if (activeVersion) {\n          currentConfig = extractConfigFromVersion(\n            activeVersion as unknown as Record<string, unknown>,\n            MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n          );\n        }\n      }\n\n      const latestVersion = await mcpClientStore.getLatestVersion(mcpClientId);\n\n      // If no activeVersionId, fall back to latest version config\n      if (!mcpClient.activeVersionId && latestVersion) {\n        currentConfig = extractConfigFromVersion(\n          latestVersion as unknown as Record<string, unknown>,\n          MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n        );\n      }\n      const previousConfig = latestVersion\n        ? extractConfigFromVersion(\n            latestVersion as unknown as Record<string, unknown>,\n            MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n          )\n        : null;\n\n      const changedFields = calculateChangedFields(previousConfig, currentConfig);\n\n      const { versionId } = await createVersionWithRetry(\n        mcpClientStore as unknown as VersionedStoreInterface,\n        mcpClientId,\n        'mcpClientId',\n        currentConfig,\n        changedFields,\n        { changeMessage },\n      );\n\n      const version = await mcpClientStore.getVersion(versionId);\n      if (!version) {\n        throw new HTTPException(500, { message: 'Failed to retrieve created version' });\n      }\n\n      await enforceRetentionLimit(\n        mcpClientStore as unknown as VersionedStoreInterface,\n        mcpClientId,\n        'mcpClientId',\n        mcpClient.activeVersionId,\n      );\n\n      return version;\n    } catch (error) {\n      return handleError(error, 'Error creating MCP client version');\n    }\n  },\n});\n\n/**\n * GET /stored/mcp-clients/:mcpClientId/versions/:versionId - Get a specific version\n */\nexport const GET_MCP_CLIENT_VERSION_ROUTE = createRoute({\n  method: 'GET',\n  path: '/stored/mcp-clients/:mcpClientId/versions/:versionId',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionIdPathParams,\n  responseSchema: getMCPClientVersionResponseSchema,\n  summary: 'Get MCP client version',\n  description: 'Returns a specific version of an MCP client by its version ID',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, versionId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const version = await mcpClientStore.getVersion(versionId);\n\n      if (!version) {\n        throw new HTTPException(404, { message: `Version with id ${versionId} not found` });\n      }\n\n      if (version.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${versionId} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      return version;\n    } catch (error) {\n      return handleError(error, 'Error getting MCP client version');\n    }\n  },\n});\n\n/**\n * POST /stored/mcp-clients/:mcpClientId/versions/:versionId/activate - Set a version as active\n */\nexport const ACTIVATE_MCP_CLIENT_VERSION_ROUTE = createRoute({\n  method: 'POST',\n  path: '/stored/mcp-clients/:mcpClientId/versions/:versionId/activate',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionIdPathParams,\n  responseSchema: activateMCPClientVersionResponseSchema,\n  summary: 'Activate MCP client version',\n  description: 'Sets a specific version as the active version for the MCP client',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, versionId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const mcpClient = await mcpClientStore.getById(mcpClientId);\n      if (!mcpClient) {\n        throw new HTTPException(404, { message: `MCP client with id ${mcpClientId} not found` });\n      }\n\n      const version = await mcpClientStore.getVersion(versionId);\n      if (!version) {\n        throw new HTTPException(404, { message: `Version with id ${versionId} not found` });\n      }\n      if (version.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${versionId} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      await mcpClientStore.update({\n        id: mcpClientId,\n        activeVersionId: versionId,\n        status: 'published',\n      });\n\n      // Clear the editor cache so subsequent requests see the new active version\n      mastra.getEditor()?.mcp.clearCache(mcpClientId);\n\n      return {\n        success: true,\n        message: `Version ${version.versionNumber} is now active`,\n        activeVersionId: versionId,\n      };\n    } catch (error) {\n      return handleError(error, 'Error activating MCP client version');\n    }\n  },\n});\n\n/**\n * POST /stored/mcp-clients/:mcpClientId/versions/:versionId/restore - Restore MCP client to a version\n */\nexport const RESTORE_MCP_CLIENT_VERSION_ROUTE = createRoute({\n  method: 'POST',\n  path: '/stored/mcp-clients/:mcpClientId/versions/:versionId/restore',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionIdPathParams,\n  responseSchema: restoreMCPClientVersionResponseSchema,\n  summary: 'Restore MCP client version',\n  description: 'Restores the MCP client configuration from a version, creating a new version',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, versionId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const mcpClient = await mcpClientStore.getById(mcpClientId);\n      if (!mcpClient) {\n        throw new HTTPException(404, { message: `MCP client with id ${mcpClientId} not found` });\n      }\n\n      const versionToRestore = await mcpClientStore.getVersion(versionId);\n      if (!versionToRestore) {\n        throw new HTTPException(404, { message: `Version with id ${versionId} not found` });\n      }\n      if (versionToRestore.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${versionId} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      const restoredConfig = extractConfigFromVersion(\n        versionToRestore as unknown as Record<string, unknown>,\n        MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n      );\n\n      await mcpClientStore.update({\n        id: mcpClientId,\n        ...restoredConfig,\n      });\n\n      const latestVersion = await mcpClientStore.getLatestVersion(mcpClientId);\n      const previousConfig = latestVersion\n        ? extractConfigFromVersion(\n            latestVersion as unknown as Record<string, unknown>,\n            MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n          )\n        : null;\n\n      const changedFields = calculateChangedFields(previousConfig, restoredConfig);\n\n      const { versionId: newVersionId } = await createVersionWithRetry(\n        mcpClientStore as unknown as VersionedStoreInterface,\n        mcpClientId,\n        'mcpClientId',\n        restoredConfig,\n        changedFields,\n        {\n          changeMessage: `Restored from version ${versionToRestore.versionNumber}`,\n        },\n      );\n\n      const newVersion = await mcpClientStore.getVersion(newVersionId);\n      if (!newVersion) {\n        throw new HTTPException(500, { message: 'Failed to retrieve created version' });\n      }\n\n      await enforceRetentionLimit(\n        mcpClientStore as unknown as VersionedStoreInterface,\n        mcpClientId,\n        'mcpClientId',\n        mcpClient.activeVersionId,\n      );\n\n      // Clear the editor cache so subsequent requests see the updated config\n      mastra.getEditor()?.mcp.clearCache(mcpClientId);\n\n      return newVersion;\n    } catch (error) {\n      return handleError(error, 'Error restoring MCP client version');\n    }\n  },\n});\n\n/**\n * DELETE /stored/mcp-clients/:mcpClientId/versions/:versionId - Delete a version\n */\nexport const DELETE_MCP_CLIENT_VERSION_ROUTE = createRoute({\n  method: 'DELETE',\n  path: '/stored/mcp-clients/:mcpClientId/versions/:versionId',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionIdPathParams,\n  responseSchema: deleteMCPClientVersionResponseSchema,\n  summary: 'Delete MCP client version',\n  description: 'Deletes a specific version (cannot delete the active version)',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, versionId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const mcpClient = await mcpClientStore.getById(mcpClientId);\n      if (!mcpClient) {\n        throw new HTTPException(404, { message: `MCP client with id ${mcpClientId} not found` });\n      }\n\n      const version = await mcpClientStore.getVersion(versionId);\n      if (!version) {\n        throw new HTTPException(404, { message: `Version with id ${versionId} not found` });\n      }\n      if (version.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${versionId} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      if (mcpClient.activeVersionId === versionId) {\n        throw new HTTPException(400, {\n          message: 'Cannot delete the active version. Activate a different version first.',\n        });\n      }\n\n      await mcpClientStore.deleteVersion(versionId);\n\n      // Clear the editor cache so subsequent requests see the updated config\n      mastra.getEditor()?.mcp.clearCache(mcpClientId);\n\n      return {\n        success: true,\n        message: `Version ${version.versionNumber} deleted successfully`,\n      };\n    } catch (error) {\n      return handleError(error, 'Error deleting MCP client version');\n    }\n  },\n});\n\n/**\n * GET /stored/mcp-clients/:mcpClientId/versions/compare - Compare two versions\n */\nexport const COMPARE_MCP_CLIENT_VERSIONS_ROUTE = createRoute({\n  method: 'GET',\n  path: '/stored/mcp-clients/:mcpClientId/versions/compare',\n  requiresAuth: true,\n  responseType: 'json',\n  pathParamSchema: mcpClientVersionPathParams,\n  queryParamSchema: compareMCPClientVersionsQuerySchema,\n  responseSchema: compareMCPClientVersionsResponseSchema,\n  summary: 'Compare MCP client versions',\n  description: 'Compares two versions and returns the differences between them',\n  tags: ['MCP Client Versions'],\n  handler: async ({ mastra, mcpClientId, from, to }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const mcpClientStore = await storage.getStore('mcpClients');\n      if (!mcpClientStore) {\n        throw new HTTPException(500, { message: 'MCP clients storage domain is not available' });\n      }\n\n      const fromVersion = await mcpClientStore.getVersion(from);\n      if (!fromVersion) {\n        throw new HTTPException(404, { message: `Version with id ${from} not found` });\n      }\n      if (fromVersion.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${from} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      const toVersion = await mcpClientStore.getVersion(to);\n      if (!toVersion) {\n        throw new HTTPException(404, { message: `Version with id ${to} not found` });\n      }\n      if (toVersion.mcpClientId !== mcpClientId) {\n        throw new HTTPException(404, {\n          message: `Version with id ${to} not found for MCP client ${mcpClientId}`,\n        });\n      }\n\n      const fromConfig = extractConfigFromVersion(\n        fromVersion as unknown as Record<string, unknown>,\n        MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n      );\n      const toConfig = extractConfigFromVersion(\n        toVersion as unknown as Record<string, unknown>,\n        MCP_CLIENT_SNAPSHOT_CONFIG_FIELDS,\n      );\n\n      const diffs = computeVersionDiffs(fromConfig, toConfig);\n\n      return {\n        diffs,\n        fromVersion,\n        toVersion,\n      };\n    } catch (error) {\n      return handleError(error, 'Error comparing MCP client versions');\n    }\n  },\n});\n"]}