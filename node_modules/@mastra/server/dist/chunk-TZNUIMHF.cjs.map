{"version":3,"sources":["../src/server/schemas/stored-skills.ts","../src/server/handlers/stored-skills.ts"],"names":["z","createPagePaginationSchema","paginationInfoSchema","createRoute","HTTPException","handleError","toSlug","LocalSkillSource"],"mappings":"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","file":"chunk-TZNUIMHF.cjs","sourcesContent":["import z from 'zod';\n\nimport { paginationInfoSchema, createPagePaginationSchema } from './common';\n\n// ============================================================================\n// Path Parameter Schemas\n// ============================================================================\n\nexport const storedSkillIdPathParams = z.object({\n  storedSkillId: z.string().describe('Unique identifier for the stored skill'),\n});\n\n// ============================================================================\n// Query Parameter Schemas\n// ============================================================================\n\nconst storageOrderBySchema = z.object({\n  field: z.enum(['createdAt', 'updatedAt']).optional(),\n  direction: z.enum(['ASC', 'DESC']).optional(),\n});\n\nexport const listStoredSkillsQuerySchema = createPagePaginationSchema(100).extend({\n  orderBy: storageOrderBySchema.optional(),\n  authorId: z.string().optional().describe('Filter skills by author identifier'),\n  metadata: z.record(z.string(), z.unknown()).optional().describe('Filter skills by metadata key-value pairs'),\n});\n\n// ============================================================================\n// Body Parameter Schemas\n// ============================================================================\n\nconst sourceSchema = z.discriminatedUnion('type', [\n  z.object({\n    type: z.literal('external'),\n    packagePath: z.string().describe('Package path for external source'),\n  }),\n  z.object({\n    type: z.literal('local'),\n    projectPath: z.string().describe('Project path for local source'),\n  }),\n  z.object({\n    type: z.literal('managed'),\n    mastraPath: z.string().describe('Mastra path for managed source'),\n  }),\n]);\n\nconst snapshotConfigSchema = z.object({\n  name: z.string().describe('Name of the skill'),\n  description: z.string().describe('Description of what the skill does and when to use it'),\n  instructions: z.string().describe('Markdown instructions for the skill'),\n  license: z.string().optional().describe('License identifier for the skill'),\n  compatibility: z.unknown().optional().describe('Compatibility requirements'),\n  source: sourceSchema.optional().describe('Source location of the skill'),\n  references: z.array(z.string()).optional().describe('List of reference file paths'),\n  scripts: z.array(z.string()).optional().describe('List of script file paths'),\n  assets: z.array(z.string()).optional().describe('List of asset file paths'),\n  metadata: z.record(z.string(), z.unknown()).optional().describe('Additional metadata for the skill'),\n});\n\nexport const createStoredSkillBodySchema = z\n  .object({\n    id: z.string().optional().describe('Unique identifier. If not provided, derived from name.'),\n    authorId: z.string().optional().describe('Author identifier for multi-tenant filtering'),\n  })\n  .merge(snapshotConfigSchema);\n\nexport const updateStoredSkillBodySchema = z\n  .object({\n    authorId: z.string().optional(),\n  })\n  .partial()\n  .merge(snapshotConfigSchema.partial());\n\n// ============================================================================\n// Response Schemas\n// ============================================================================\n\nexport const storedSkillSchema = z.object({\n  id: z.string(),\n  status: z.string().describe('Skill status: draft, published, or archived'),\n  activeVersionId: z.string().optional(),\n  authorId: z.string().optional(),\n  createdAt: z.coerce.date(),\n  updatedAt: z.coerce.date(),\n  name: z.string().describe('Name of the skill'),\n  description: z.string().describe('Description of what the skill does and when to use it'),\n  instructions: z.string().describe('Markdown instructions for the skill'),\n  license: z.string().optional().describe('License identifier for the skill'),\n  compatibility: z.unknown().optional().describe('Compatibility requirements'),\n  source: sourceSchema.optional().describe('Source location of the skill'),\n  references: z.array(z.string()).optional().describe('List of reference file paths'),\n  scripts: z.array(z.string()).optional().describe('List of script file paths'),\n  assets: z.array(z.string()).optional().describe('List of asset file paths'),\n  metadata: z.record(z.string(), z.unknown()).optional().describe('Additional metadata for the skill'),\n});\n\nexport const listStoredSkillsResponseSchema = paginationInfoSchema.extend({\n  skills: z.array(storedSkillSchema),\n});\n\nexport const getStoredSkillResponseSchema = storedSkillSchema;\nexport const createStoredSkillResponseSchema = storedSkillSchema;\n\nexport const updateStoredSkillResponseSchema = z.union([\n  z.object({\n    id: z.string(),\n    status: z.string(),\n    activeVersionId: z.string().optional(),\n    authorId: z.string().optional(),\n    createdAt: z.coerce.date(),\n    updatedAt: z.coerce.date(),\n  }),\n  storedSkillSchema,\n]);\n\nexport const deleteStoredSkillResponseSchema = z.object({\n  success: z.boolean(),\n  message: z.string(),\n});\n\n// ============================================================================\n// Publish / Rollback Schemas\n// ============================================================================\n\nexport const publishStoredSkillBodySchema = z.object({\n  skillPath: z.string().describe('Path to the skill directory on the server filesystem (containing SKILL.md)'),\n});\n\nexport const publishStoredSkillResponseSchema = storedSkillSchema;\n","import { LocalSkillSource } from '@mastra/core/workspace';\n\nimport { HTTPException } from '../http-exception';\nimport {\n  storedSkillIdPathParams,\n  listStoredSkillsQuerySchema,\n  createStoredSkillBodySchema,\n  updateStoredSkillBodySchema,\n  publishStoredSkillBodySchema,\n  listStoredSkillsResponseSchema,\n  getStoredSkillResponseSchema,\n  createStoredSkillResponseSchema,\n  updateStoredSkillResponseSchema,\n  deleteStoredSkillResponseSchema,\n  publishStoredSkillResponseSchema,\n} from '../schemas/stored-skills';\nimport { createRoute } from '../server-adapter/routes/route-builder';\nimport { toSlug } from '../utils';\n\nimport { handleError } from './error';\n\n// ============================================================================\n// Route Definitions\n// ============================================================================\n\n/**\n * GET /stored/skills - List all stored skills\n */\nexport const LIST_STORED_SKILLS_ROUTE = createRoute({\n  method: 'GET',\n  path: '/stored/skills',\n  responseType: 'json',\n  queryParamSchema: listStoredSkillsQuerySchema,\n  responseSchema: listStoredSkillsResponseSchema,\n  summary: 'List stored skills',\n  description: 'Returns a paginated list of all skill configurations stored in the database',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({ mastra, page, perPage, orderBy, authorId, metadata }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      const result = await skillStore.listResolved({\n        page,\n        perPage,\n        orderBy,\n        authorId,\n        metadata,\n      });\n\n      return result;\n    } catch (error) {\n      return handleError(error, 'Error listing stored skills');\n    }\n  },\n});\n\n/**\n * GET /stored/skills/:storedSkillId - Get a stored skill by ID\n */\nexport const GET_STORED_SKILL_ROUTE = createRoute({\n  method: 'GET',\n  path: '/stored/skills/:storedSkillId',\n  responseType: 'json',\n  pathParamSchema: storedSkillIdPathParams,\n  responseSchema: getStoredSkillResponseSchema,\n  summary: 'Get stored skill by ID',\n  description: 'Returns a specific skill from storage by its unique identifier (resolved with active version config)',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({ mastra, storedSkillId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      const skill = await skillStore.getByIdResolved(storedSkillId);\n\n      if (!skill) {\n        throw new HTTPException(404, { message: `Stored skill with id ${storedSkillId} not found` });\n      }\n\n      return skill;\n    } catch (error) {\n      return handleError(error, 'Error getting stored skill');\n    }\n  },\n});\n\n/**\n * POST /stored/skills - Create a new stored skill\n */\nexport const CREATE_STORED_SKILL_ROUTE = createRoute({\n  method: 'POST',\n  path: '/stored/skills',\n  responseType: 'json',\n  bodySchema: createStoredSkillBodySchema,\n  responseSchema: createStoredSkillResponseSchema,\n  summary: 'Create stored skill',\n  description: 'Creates a new skill configuration in storage with the provided details',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({\n    mastra,\n    id: providedId,\n    authorId,\n    name,\n    description,\n    instructions,\n    license,\n    compatibility,\n    source,\n    references,\n    scripts,\n    assets,\n    metadata,\n  }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      // Derive ID from name if not explicitly provided\n      const id = providedId || toSlug(name);\n\n      if (!id) {\n        throw new HTTPException(400, {\n          message: 'Could not derive skill ID from name. Please provide an explicit id.',\n        });\n      }\n\n      // Check if skill with this ID already exists\n      const existing = await skillStore.getById(id);\n      if (existing) {\n        throw new HTTPException(409, { message: `Skill with id ${id} already exists` });\n      }\n\n      await skillStore.create({\n        skill: {\n          id,\n          authorId,\n          name,\n          description,\n          instructions,\n          license,\n          compatibility,\n          source,\n          references,\n          scripts,\n          assets,\n          metadata,\n        },\n      });\n\n      // Return the resolved skill (thin record + version config)\n      const resolved = await skillStore.getByIdResolved(id);\n      if (!resolved) {\n        throw new HTTPException(500, { message: 'Failed to resolve created skill' });\n      }\n\n      return resolved;\n    } catch (error) {\n      return handleError(error, 'Error creating stored skill');\n    }\n  },\n});\n\n/**\n * PATCH /stored/skills/:storedSkillId - Update a stored skill\n */\nexport const UPDATE_STORED_SKILL_ROUTE = createRoute({\n  method: 'PATCH',\n  path: '/stored/skills/:storedSkillId',\n  responseType: 'json',\n  pathParamSchema: storedSkillIdPathParams,\n  bodySchema: updateStoredSkillBodySchema,\n  responseSchema: updateStoredSkillResponseSchema,\n  summary: 'Update stored skill',\n  description: 'Updates an existing skill in storage with the provided fields',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({\n    mastra,\n    storedSkillId,\n    // Entity-level fields\n    authorId,\n    // Config fields (snapshot-level)\n    name,\n    description,\n    instructions,\n    license,\n    compatibility,\n    source,\n    references,\n    scripts,\n    assets,\n    metadata,\n  }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      // Check if skill exists\n      const existing = await skillStore.getById(storedSkillId);\n      if (!existing) {\n        throw new HTTPException(404, { message: `Stored skill with id ${storedSkillId} not found` });\n      }\n\n      // Update the skill with both entity-level and config-level fields\n      // The storage layer handles separating these into record updates vs new-version creation\n      await skillStore.update({\n        id: storedSkillId,\n        authorId,\n        name,\n        description,\n        instructions,\n        license,\n        compatibility,\n        source,\n        references,\n        scripts,\n        assets,\n        metadata,\n      });\n\n      // Return the resolved skill with the updated config\n      const resolved = await skillStore.getByIdResolved(storedSkillId);\n      if (!resolved) {\n        throw new HTTPException(500, { message: 'Failed to resolve updated skill' });\n      }\n\n      return resolved;\n    } catch (error) {\n      return handleError(error, 'Error updating stored skill');\n    }\n  },\n});\n\n/**\n * DELETE /stored/skills/:storedSkillId - Delete a stored skill\n */\nexport const DELETE_STORED_SKILL_ROUTE = createRoute({\n  method: 'DELETE',\n  path: '/stored/skills/:storedSkillId',\n  responseType: 'json',\n  pathParamSchema: storedSkillIdPathParams,\n  responseSchema: deleteStoredSkillResponseSchema,\n  summary: 'Delete stored skill',\n  description: 'Deletes a skill from storage by its unique identifier',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({ mastra, storedSkillId }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      // Check if skill exists\n      const existing = await skillStore.getById(storedSkillId);\n      if (!existing) {\n        throw new HTTPException(404, { message: `Stored skill with id ${storedSkillId} not found` });\n      }\n\n      await skillStore.delete(storedSkillId);\n\n      return {\n        success: true,\n        message: `Skill ${storedSkillId} deleted successfully`,\n      };\n    } catch (error) {\n      return handleError(error, 'Error deleting stored skill');\n    }\n  },\n});\n\n/**\n * POST /stored/skills/:storedSkillId/publish - Publish a skill from filesystem\n * Walks the skill directory, hashes files into blob store, creates a new version\n * with the tree manifest, and sets activeVersionId.\n */\nexport const PUBLISH_STORED_SKILL_ROUTE = createRoute({\n  method: 'POST',\n  path: '/stored/skills/:storedSkillId/publish',\n  responseType: 'json',\n  pathParamSchema: storedSkillIdPathParams,\n  bodySchema: publishStoredSkillBodySchema,\n  responseSchema: publishStoredSkillResponseSchema,\n  summary: 'Publish stored skill',\n  description:\n    'Snapshots the skill directory from the filesystem into content-addressable blob storage, creates a new version with a tree manifest, and marks the skill as published',\n  tags: ['Stored Skills'],\n  requiresAuth: true,\n  handler: async ({ mastra, storedSkillId, skillPath }) => {\n    try {\n      const storage = mastra.getStorage();\n\n      if (!storage) {\n        throw new HTTPException(500, { message: 'Storage is not configured' });\n      }\n\n      const skillStore = await storage.getStore('skills');\n      if (!skillStore) {\n        throw new HTTPException(500, { message: 'Skills storage domain is not available' });\n      }\n\n      const blobStore = await storage.getStore('blobs');\n      if (!blobStore) {\n        throw new HTTPException(500, { message: 'Blob storage domain is not available' });\n      }\n\n      // Verify skill exists\n      const existing = await skillStore.getById(storedSkillId);\n      if (!existing) {\n        throw new HTTPException(404, { message: `Stored skill with id ${storedSkillId} not found` });\n      }\n\n      // Validate skillPath to prevent path traversal\n      const path = await import('node:path');\n      const resolvedPath = path.default.resolve(skillPath);\n      const allowedBase = path.default.resolve(process.env.SKILLS_BASE_DIR || process.cwd());\n      if (!resolvedPath.startsWith(allowedBase + path.default.sep) && resolvedPath !== allowedBase) {\n        throw new HTTPException(400, {\n          message: `skillPath must be within the allowed directory: ${allowedBase}`,\n        });\n      }\n\n      // Use LocalSkillSource to read from the server filesystem\n      const source = new LocalSkillSource();\n      const { publishSkillFromSource } = await import('@mastra/core/workspace');\n\n      const { snapshot, tree } = await publishSkillFromSource(source, resolvedPath, blobStore);\n\n      // Update the skill with new version data + tree\n      await skillStore.update({\n        id: storedSkillId,\n        ...snapshot,\n        tree,\n        status: 'published',\n      });\n\n      // Point activeVersionId to the newly created version\n      const latestVersion = await skillStore.getLatestVersion(storedSkillId);\n      if (latestVersion) {\n        await skillStore.update({\n          id: storedSkillId,\n          activeVersionId: latestVersion.id,\n        });\n      }\n\n      const resolved = await skillStore.getByIdResolved(storedSkillId);\n      if (!resolved) {\n        throw new HTTPException(500, { message: 'Failed to resolve skill after publish' });\n      }\n\n      return resolved;\n    } catch (error) {\n      return handleError(error, 'Error publishing stored skill');\n    }\n  },\n});\n"]}