{"version":3,"sources":["../src/server/schemas/memory-config.ts","../src/server/schemas/stored-agents.ts"],"names":["z","snapshotConfigSchema"],"mappings":"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","file":"chunk-EBOYKPNI.js","sourcesContent":["import z from 'zod';\n\n/**\n * Shared memory configuration schemas for agent storage\n * These schemas match the SerializedMemoryConfig type from @mastra/core\n */\n\n/**\n * Semantic recall configuration for vector-based memory retrieval\n */\nexport const semanticRecallSchema = z.object({\n  topK: z.number().describe('Number of semantically similar messages to retrieve'),\n  messageRange: z\n    .union([\n      z.number(),\n      z.object({\n        before: z.number(),\n        after: z.number(),\n      }),\n    ])\n    .describe('Amount of surrounding context to include with each retrieved message'),\n  scope: z.enum(['thread', 'resource']).optional().describe('Scope for semantic search queries'),\n  threshold: z.number().min(0).max(1).optional().describe('Minimum similarity score threshold'),\n  indexName: z.string().optional().describe('Index name for the vector store'),\n});\n\n/**\n * Title generation configuration\n * When stored, the model is serialized as a ModelRouterModelId string (provider/model-name format)\n */\nexport const titleGenerationSchema = z.union([\n  z.boolean(),\n  z.object({\n    model: z.string().describe('Model ID in format provider/model-name (ModelRouterModelId)'),\n    instructions: z.string().optional().describe('Custom instructions for title generation'),\n  }),\n]);\n\n/**\n * Observation step configuration for observational memory\n */\nexport const serializedObservationConfigSchema = z.object({\n  model: z.string().optional().describe('Observer model ID'),\n  messageTokens: z.number().optional().describe('Token threshold that triggers observation'),\n  modelSettings: z.record(z.string(), z.unknown()).optional().describe('Model settings (temperature, etc.)'),\n  providerOptions: z\n    .record(z.string(), z.record(z.string(), z.unknown()).optional())\n    .optional()\n    .describe('Provider-specific options'),\n  maxTokensPerBatch: z.number().optional().describe('Maximum tokens per batch'),\n  bufferTokens: z\n    .union([z.number(), z.literal(false)])\n    .optional()\n    .describe('Async buffering interval or false'),\n  bufferActivation: z.number().optional().describe('Ratio of buffered observations to activate'),\n  blockAfter: z.number().optional().describe('Token threshold for synchronous blocking'),\n});\n\n/**\n * Reflection step configuration for observational memory\n */\nexport const serializedReflectionConfigSchema = z.object({\n  model: z.string().optional().describe('Reflector model ID'),\n  observationTokens: z.number().optional().describe('Token threshold that triggers reflection'),\n  modelSettings: z.record(z.string(), z.unknown()).optional().describe('Model settings (temperature, etc.)'),\n  providerOptions: z\n    .record(z.string(), z.record(z.string(), z.unknown()).optional())\n    .optional()\n    .describe('Provider-specific options'),\n  blockAfter: z.number().optional().describe('Token threshold for synchronous blocking'),\n  bufferActivation: z.number().optional().describe('Ratio for async reflection buffering'),\n});\n\n/**\n * Serialized observational memory configuration\n */\nexport const serializedObservationalMemoryConfigObjectSchema = z.object({\n  model: z.string().optional().describe('Model ID for both Observer and Reflector'),\n  scope: z.enum(['resource', 'thread']).optional().describe('Memory scope'),\n  shareTokenBudget: z.boolean().optional().describe('Share token budget between messages and observations'),\n  observation: serializedObservationConfigSchema.optional().describe('Observation step configuration'),\n  reflection: serializedReflectionConfigSchema.optional().describe('Reflection step configuration'),\n});\n\nexport const serializedObservationalMemoryConfigSchema = z.union([\n  z.boolean(),\n  serializedObservationalMemoryConfigObjectSchema,\n]);\n\n/**\n * Serialized memory configuration matching SerializedMemoryConfig from @mastra/core\n *\n * Note: workingMemory and threads are omitted as they are not part of SerializedMemoryConfig\n * @see packages/core/src/memory/types.ts\n */\nexport const serializedMemoryConfigSchema = z\n  .object({\n    vector: z\n      .union([z.string(), z.literal(false)])\n      .optional()\n      .describe('Vector database identifier or false to disable'),\n    options: z\n      .object({\n        readOnly: z.boolean().optional(),\n        lastMessages: z.union([z.number(), z.literal(false)]).optional(),\n        semanticRecall: z.union([z.boolean(), semanticRecallSchema]).optional(),\n        generateTitle: titleGenerationSchema.optional(),\n      })\n      .optional()\n      .describe('Memory behavior configuration, excluding workingMemory and threads'),\n    embedder: z\n      .string()\n      .optional()\n      .describe('Embedding model ID in the format \"provider/model\" (e.g., \"openai/text-embedding-3-small\")'),\n    embedderOptions: z\n      .record(z.string(), z.unknown())\n      .optional()\n      .describe('Options to pass to the embedder, omitting telemetry'),\n    observationalMemory: serializedObservationalMemoryConfigSchema\n      .optional()\n      .describe('Serialized observational memory configuration'),\n  })\n  .refine(\n    data => {\n      // If semanticRecall is enabled (true or object), both vector and embedder are required\n      const semanticRecall = data.options?.semanticRecall;\n      const semanticRecallEnabled =\n        semanticRecall === true || (typeof semanticRecall === 'object' && semanticRecall !== null);\n\n      if (semanticRecallEnabled) {\n        // vector must be a string (not false or undefined)\n        const hasVector = typeof data.vector === 'string' && data.vector.length > 0;\n        // embedder must be defined\n        const hasEmbedder = typeof data.embedder === 'string' && data.embedder.length > 0;\n\n        return hasVector && hasEmbedder;\n      }\n      return true;\n    },\n    {\n      message: 'Semantic recall requires both vector and embedder to be configured',\n      path: ['options', 'semanticRecall'],\n    },\n  );\n","import z from 'zod';\nimport { paginationInfoSchema, createPagePaginationSchema, statusQuerySchema } from './common';\nimport { defaultOptionsSchema } from './default-options';\nimport { serializedMemoryConfigSchema } from './memory-config';\nimport { ruleGroupSchema } from './rule-group';\nimport { workspaceSnapshotConfigSchema } from './stored-workspaces';\n\n// ============================================================================\n// Path Parameter Schemas\n// ============================================================================\n\n/**\n * Path parameter for stored agent ID\n */\nexport const storedAgentIdPathParams = z.object({\n  storedAgentId: z.string().describe('Unique identifier for the stored agent'),\n});\n\n// ============================================================================\n// Query Parameter Schemas\n// ============================================================================\n\n/**\n * Storage order by configuration\n */\nconst storageOrderBySchema = z.object({\n  field: z.enum(['createdAt', 'updatedAt']).optional(),\n  direction: z.enum(['ASC', 'DESC']).optional(),\n});\n\nexport { statusQuerySchema };\n\n/**\n * GET /stored/agents - List stored agents\n */\nexport const listStoredAgentsQuerySchema = createPagePaginationSchema(100).extend({\n  orderBy: storageOrderBySchema.optional(),\n  status: z\n    .enum(['draft', 'published', 'archived'])\n    .optional()\n    .default('published')\n    .describe('Filter agents by status (defaults to published)'),\n  authorId: z.string().optional().describe('Filter agents by author identifier'),\n  metadata: z.record(z.string(), z.unknown()).optional().describe('Filter agents by metadata key-value pairs'),\n});\n\n// ============================================================================\n// Body Parameter Schemas\n// ============================================================================\n\n/**\n * Scorer config schema with optional sampling and rules\n */\nconst scorerConfigSchema = z.object({\n  description: z.string().optional(),\n  sampling: z\n    .union([\n      z.object({ type: z.literal('none') }),\n      z.object({ type: z.literal('ratio'), rate: z.number().min(0).max(1) }),\n    ])\n    .optional(),\n  rules: ruleGroupSchema.optional(),\n});\n\n/**\n * Agent instruction block schema for prompt-block-based instructions.\n */\nconst agentInstructionBlockSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('text'), content: z.string() }),\n  z.object({ type: z.literal('prompt_block_ref'), id: z.string() }),\n  z.object({ type: z.literal('prompt_block'), content: z.string(), rules: ruleGroupSchema.optional() }),\n]);\n\n/**\n * Creates a schema for a field that can be either a static value or an array of conditional variants.\n * Each variant has a `value` and an optional `rules` (RuleGroup) that determines when it applies.\n */\nfunction conditionalFieldSchema<T extends z.ZodTypeAny>(valueSchema: T) {\n  const variantSchema = z.object({\n    value: valueSchema,\n    rules: ruleGroupSchema.optional(),\n  });\n  return z.union([valueSchema, z.array(variantSchema)]);\n}\n\n/**\n * Instructions can be a plain string or an array of instruction blocks (text + prompt_block references).\n */\nexport const instructionsSchema = z\n  .union([z.string(), z.array(agentInstructionBlockSchema)])\n  .describe('System instructions for the agent (string or array of instruction blocks)');\n\n/** Base model config schema (reused across snapshot and response schemas) */\nconst modelConfigSchema = z\n  .object({\n    provider: z.string().describe('Model provider (e.g., openai, anthropic)'),\n    name: z.string().describe('Model name (e.g., gpt-4o, claude-3-opus)'),\n  })\n  .passthrough();\n\n/** Per-tool config schema */\nconst toolConfigSchema = z.object({ description: z.string().optional(), rules: ruleGroupSchema.optional() });\n\n/** Base tools config schema */\nconst toolsConfigSchema = z.record(z.string(), toolConfigSchema);\n\n/** MCP client tools config schema — specifies which tools to use from an MCP client/server */\nconst mcpClientToolsConfigSchema = z.object({\n  tools: z.record(z.string(), toolConfigSchema).optional(),\n});\n\n/** Per-skill config schema */\nconst skillConfigSchema = z.object({\n  description: z.string().optional(),\n  instructions: z.string().optional(),\n  pin: z.string().optional(),\n  strategy: z.enum(['latest', 'live']).optional(),\n});\n\n/** Skills config: skill IDs mapped to per-skill config */\nconst skillsConfigSchema = z.record(z.string(), skillConfigSchema);\n\n/** Workspace reference: either a stored workspace ID or an inline config */\nconst workspaceRefSchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('id'), workspaceId: z.string() }),\n  z.object({ type: z.literal('inline'), config: workspaceSnapshotConfigSchema }),\n]);\n\n/**\n * Processor phase enum matching ProcessorPhase type\n */\nconst processorPhaseSchema = z.enum([\n  'processInput',\n  'processInputStep',\n  'processOutputStream',\n  'processOutputResult',\n  'processOutputStep',\n]);\n\n/**\n * A single processor step in a stored processor graph.\n */\nconst processorGraphStepSchema = z.object({\n  id: z.string().describe('Unique ID for this step within the graph'),\n  providerId: z.string().describe('ProcessorProvider ID that creates this processor'),\n  config: z.record(z.string(), z.unknown()).describe('Configuration matching the provider configSchema'),\n  enabledPhases: z.array(processorPhaseSchema).min(1).describe('Which processor phases to enable'),\n});\n\n/**\n * Processor graph entry schema.\n * Simplified version of SerializedStepFlowEntry, supporting step, parallel, and conditional.\n *\n * Uses a fixed nesting depth (3 levels) to avoid infinite recursion\n * when converting to JSON Schema / OpenAPI.\n */\n\n/** Depth 3 (leaf): only step entries allowed */\nconst processorGraphEntryDepth3 = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('step'), step: processorGraphStepSchema }),\n]);\n\n/** Depth 2: step, parallel, and conditional — children limited to depth 3 */\nconst processorGraphEntryDepth2 = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('step'), step: processorGraphStepSchema }),\n  z.object({ type: z.literal('parallel'), branches: z.array(z.array(processorGraphEntryDepth3)) }),\n  z.object({\n    type: z.literal('conditional'),\n    conditions: z.array(\n      z.object({\n        steps: z.array(processorGraphEntryDepth3),\n        rules: ruleGroupSchema.optional(),\n      }),\n    ),\n  }),\n]);\n\n/** Depth 1 (top-level): step, parallel, and conditional — children limited to depth 2 */\nconst processorGraphEntrySchema = z.discriminatedUnion('type', [\n  z.object({ type: z.literal('step'), step: processorGraphStepSchema }),\n  z.object({ type: z.literal('parallel'), branches: z.array(z.array(processorGraphEntryDepth2)) }),\n  z.object({\n    type: z.literal('conditional'),\n    conditions: z.array(\n      z.object({\n        steps: z.array(processorGraphEntryDepth2),\n        rules: ruleGroupSchema.optional(),\n      }),\n    ),\n  }),\n]);\n\n/**\n * A stored processor graph representing a pipeline of processors.\n */\nconst storedProcessorGraphSchema = z.object({\n  steps: z.array(processorGraphEntrySchema).describe('Ordered list of processor graph entries'),\n});\n\n/**\n * Agent snapshot config fields (name, description, instructions, model, tools, etc.)\n * These live in version snapshots, not on the thin agent record.\n *\n * Fields that support conditional variants (StorageConditionalField) can be either\n * a static value OR an array of { value, rules? } variants evaluated at request time.\n */\nconst snapshotConfigSchema = z.object({\n  name: z.string().describe('Name of the agent'),\n  description: z.string().optional().describe('Description of the agent'),\n  instructions: instructionsSchema,\n  model: conditionalFieldSchema(modelConfigSchema).describe(\n    'Model configuration — static value or array of conditional variants',\n  ),\n  tools: conditionalFieldSchema(toolsConfigSchema)\n    .optional()\n    .describe('Tool keys mapped to per-tool config — static or conditional'),\n  defaultOptions: conditionalFieldSchema(defaultOptionsSchema)\n    .optional()\n    .describe('Default options for generate/stream calls — static or conditional'),\n  workflows: conditionalFieldSchema(z.record(z.string(), toolConfigSchema))\n    .optional()\n    .describe('Workflow keys with optional per-workflow config — static or conditional'),\n  agents: conditionalFieldSchema(z.record(z.string(), toolConfigSchema))\n    .optional()\n    .describe('Agent keys with optional per-agent config — static or conditional'),\n  integrationTools: conditionalFieldSchema(z.record(z.string(), mcpClientToolsConfigSchema))\n    .optional()\n    .describe('Map of tool provider IDs to their tool configurations — static or conditional'),\n  mcpClients: conditionalFieldSchema(z.record(z.string(), mcpClientToolsConfigSchema))\n    .optional()\n    .describe('Map of stored MCP client IDs to their tool configurations — static or conditional'),\n  inputProcessors: conditionalFieldSchema(storedProcessorGraphSchema)\n    .optional()\n    .describe('Input processor graph — static or conditional'),\n  outputProcessors: conditionalFieldSchema(storedProcessorGraphSchema)\n    .optional()\n    .describe('Output processor graph — static or conditional'),\n  memory: conditionalFieldSchema(serializedMemoryConfigSchema)\n    .optional()\n    .describe('Memory configuration — static or conditional'),\n  scorers: conditionalFieldSchema(z.record(z.string(), scorerConfigSchema))\n    .optional()\n    .describe('Scorer keys with optional sampling config — static or conditional'),\n  skills: conditionalFieldSchema(skillsConfigSchema)\n    .optional()\n    .describe('Skill IDs mapped to per-skill config — static or conditional'),\n  workspace: conditionalFieldSchema(workspaceRefSchema)\n    .optional()\n    .describe('Workspace reference (stored ID or inline config) — static or conditional'),\n  requestContextSchema: z\n    .record(z.string(), z.unknown())\n    .optional()\n    .describe('JSON Schema defining valid request context variables for conditional rule evaluation'),\n});\n\n/**\n * Agent metadata fields (authorId, metadata) that live on the thin agent record.\n */\nconst agentMetadataSchema = z.object({\n  authorId: z.string().optional().describe('Author identifier for multi-tenant filtering'),\n  metadata: z.record(z.string(), z.unknown()).optional().describe('Additional metadata for the agent'),\n});\n\n/**\n * POST /stored/agents - Create stored agent body\n * Flat union of agent-record fields + config fields\n * The id is optional — if not provided, it will be derived from the agent name via slugify.\n */\nexport const createStoredAgentBodySchema = z\n  .object({\n    id: z.string().optional().describe('Unique identifier for the agent. If not provided, derived from name.'),\n    authorId: z.string().optional().describe('Author identifier for multi-tenant filtering'),\n    metadata: z.record(z.string(), z.unknown()).optional().describe('Additional metadata for the agent'),\n  })\n  .merge(snapshotConfigSchema);\n\n/**\n * Snapshot config schema for updates where nullable fields (like memory) can be set to null to clear them.\n */\nconst snapshotConfigUpdateSchema = snapshotConfigSchema.extend({\n  memory: z\n    .union([conditionalFieldSchema(serializedMemoryConfigSchema), z.null()])\n    .optional()\n    .describe('Memory configuration — static, conditional, or null to disable memory'),\n});\n\n/**\n * PATCH /stored/agents/:storedAgentId - Update stored agent body\n * Optional metadata-level fields + optional config fields\n */\nexport const updateStoredAgentBodySchema = agentMetadataSchema.partial().merge(snapshotConfigUpdateSchema.partial());\n\n// ============================================================================\n// Response Schemas\n// ============================================================================\n\n/**\n * Stored agent object schema (resolved response: thin record + version config)\n * Represents StorageResolvedAgentType\n */\nexport const storedAgentSchema = z.object({\n  // Thin agent record fields\n  id: z.string(),\n  status: z.string().describe('Agent status: draft or published'),\n  activeVersionId: z.string().optional(),\n  authorId: z.string().optional(),\n  metadata: z.record(z.string(), z.unknown()).optional(),\n  createdAt: z.coerce.date(),\n  updatedAt: z.coerce.date(),\n  // Version snapshot config fields (resolved from active version)\n  name: z.string().describe('Name of the agent'),\n  description: z.string().optional().describe('Description of the agent'),\n  instructions: instructionsSchema,\n  model: conditionalFieldSchema(modelConfigSchema).describe(\n    'Model configuration — static value or array of conditional variants',\n  ),\n  tools: conditionalFieldSchema(toolsConfigSchema)\n    .optional()\n    .describe('Tool keys mapped to per-tool config — static or conditional'),\n  defaultOptions: conditionalFieldSchema(defaultOptionsSchema)\n    .optional()\n    .describe('Default options for generate/stream calls — static or conditional'),\n  workflows: conditionalFieldSchema(z.record(z.string(), toolConfigSchema))\n    .optional()\n    .describe('Workflow keys with optional per-workflow config — static or conditional'),\n  agents: conditionalFieldSchema(z.record(z.string(), toolConfigSchema))\n    .optional()\n    .describe('Agent keys with optional per-agent config — static or conditional'),\n  integrationTools: conditionalFieldSchema(z.record(z.string(), mcpClientToolsConfigSchema))\n    .optional()\n    .describe('Map of tool provider IDs to their tool configurations — static or conditional'),\n  mcpClients: conditionalFieldSchema(z.record(z.string(), mcpClientToolsConfigSchema))\n    .optional()\n    .describe('Map of stored MCP client IDs to their tool configurations — static or conditional'),\n  inputProcessors: conditionalFieldSchema(storedProcessorGraphSchema)\n    .optional()\n    .describe('Input processor graph — static or conditional'),\n  outputProcessors: conditionalFieldSchema(storedProcessorGraphSchema)\n    .optional()\n    .describe('Output processor graph — static or conditional'),\n  memory: conditionalFieldSchema(serializedMemoryConfigSchema)\n    .optional()\n    .describe('Memory configuration — static or conditional'),\n  scorers: conditionalFieldSchema(z.record(z.string(), scorerConfigSchema))\n    .optional()\n    .describe('Scorer keys with optional sampling config — static or conditional'),\n  skills: conditionalFieldSchema(skillsConfigSchema)\n    .optional()\n    .describe('Skill IDs mapped to per-skill config — static or conditional'),\n  workspace: conditionalFieldSchema(workspaceRefSchema)\n    .optional()\n    .describe('Workspace reference (stored ID or inline config) — static or conditional'),\n  requestContextSchema: z\n    .record(z.string(), z.unknown())\n    .optional()\n    .describe('JSON Schema defining valid request context variables'),\n});\n\n/**\n * Response for GET /stored/agents\n */\nexport const listStoredAgentsResponseSchema = paginationInfoSchema.extend({\n  agents: z.array(storedAgentSchema),\n});\n\n/**\n * Response for GET /stored/agents/:storedAgentId\n */\nexport const getStoredAgentResponseSchema = storedAgentSchema;\n\n/**\n * Response for POST /stored/agents\n */\nexport const createStoredAgentResponseSchema = storedAgentSchema;\n\n/**\n * Response for PATCH /stored/agents/:storedAgentId\n *\n * The response can be either:\n * 1. A thin agent record (no version) - only has id, status, dates, etc.\n * 2. A resolved agent (with version) - has all config fields from the version\n *\n * We use a union to handle both cases properly.\n */\nexport const updateStoredAgentResponseSchema = z.union([\n  // Thin agent record (no version config)\n  z.object({\n    id: z.string(),\n    status: z.string(),\n    activeVersionId: z.string().optional(),\n    authorId: z.string().optional(),\n    metadata: z.record(z.string(), z.unknown()).optional(),\n    createdAt: z.coerce.date(),\n    updatedAt: z.coerce.date(),\n  }),\n  // Resolved agent (thin record + version config)\n  storedAgentSchema,\n]);\n\n/**\n * Response for DELETE /stored/agents/:storedAgentId\n */\nexport const deleteStoredAgentResponseSchema = z.object({\n  success: z.boolean(),\n  message: z.string(),\n});\n\n// ============================================================================\n// Preview Instructions Schemas\n// ============================================================================\n\n/**\n * POST /stored/agents/preview-instructions - Preview resolved instructions\n */\nexport const previewInstructionsBodySchema = z.object({\n  blocks: z.array(agentInstructionBlockSchema).describe('Array of instruction blocks to resolve'),\n  context: z\n    .record(z.string(), z.unknown())\n    .optional()\n    .default({})\n    .describe('Request context for variable interpolation and rule evaluation'),\n});\n\n/**\n * Response for POST /stored/agents/preview-instructions\n */\nexport const previewInstructionsResponseSchema = z.object({\n  result: z.string().describe('The resolved instructions string'),\n});\n\n/**\n * Exported for use in agent-versions.ts schemas\n */\nexport {\n  snapshotConfigSchema,\n  scorerConfigSchema,\n  conditionalFieldSchema,\n  modelConfigSchema,\n  storedProcessorGraphSchema,\n  processorGraphStepSchema,\n  processorGraphEntrySchema,\n  processorPhaseSchema,\n  toolConfigSchema,\n  toolsConfigSchema,\n};\n"]}