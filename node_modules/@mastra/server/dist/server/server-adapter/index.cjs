'use strict';

var chunkTZNUIMHF_cjs = require('../../chunk-TZNUIMHF.cjs');
var chunk335CI24F_cjs = require('../../chunk-335CI24F.cjs');
var chunkT5KH32UA_cjs = require('../../chunk-T5KH32UA.cjs');
var chunkGHD37MZU_cjs = require('../../chunk-GHD37MZU.cjs');
var chunkKPDZYFEE_cjs = require('../../chunk-KPDZYFEE.cjs');
var chunkZE4IJKQD_cjs = require('../../chunk-ZE4IJKQD.cjs');
var chunkICHZVTM6_cjs = require('../../chunk-ICHZVTM6.cjs');
var chunk2TI7W63K_cjs = require('../../chunk-2TI7W63K.cjs');
var chunkEHZ4BAYY_cjs = require('../../chunk-EHZ4BAYY.cjs');
var chunkMJLQLQ6K_cjs = require('../../chunk-MJLQLQ6K.cjs');
var chunkFOOBWL6U_cjs = require('../../chunk-FOOBWL6U.cjs');
var chunkYNYUGFB5_cjs = require('../../chunk-YNYUGFB5.cjs');
var chunkBD254TQA_cjs = require('../../chunk-BD254TQA.cjs');
var chunkPUHV6FJA_cjs = require('../../chunk-PUHV6FJA.cjs');
var chunkRP44EZSX_cjs = require('../../chunk-RP44EZSX.cjs');
var chunk6OM4GWXC_cjs = require('../../chunk-6OM4GWXC.cjs');
var chunkRU5PL7RD_cjs = require('../../chunk-RU5PL7RD.cjs');
var chunkEHHCBPKQ_cjs = require('../../chunk-EHHCBPKQ.cjs');
var chunk2XI7ZVGF_cjs = require('../../chunk-2XI7ZVGF.cjs');
var chunkCFW3KNV7_cjs = require('../../chunk-CFW3KNV7.cjs');
var chunk5LNN2GWK_cjs = require('../../chunk-5LNN2GWK.cjs');
var chunkUXMTV44Q_cjs = require('../../chunk-UXMTV44Q.cjs');
var chunkAV3VZ6S3_cjs = require('../../chunk-AV3VZ6S3.cjs');
var chunkAAHPYUEC_cjs = require('../../chunk-AAHPYUEC.cjs');
var chunkZ5EVXSXL_cjs = require('../../chunk-Z5EVXSXL.cjs');
var chunkPLW5CELE_cjs = require('../../chunk-PLW5CELE.cjs');
var chunkG2W3A4FZ_cjs = require('../../chunk-G2W3A4FZ.cjs');
var chunkSY6MLMJF_cjs = require('../../chunk-SY6MLMJF.cjs');
var chunk5JH2BJPC_cjs = require('../../chunk-5JH2BJPC.cjs');
var chunkHHE6BWUK_cjs = require('../../chunk-HHE6BWUK.cjs');
var chunk4LVJBXI2_cjs = require('../../chunk-4LVJBXI2.cjs');
var requestContext = require('@mastra/core/request-context');
var server = require('@mastra/core/server');
var hono = require('hono');

// src/server/server-adapter/routes/a2a.ts
var A2A_ROUTES = [chunkZ5EVXSXL_cjs.GET_AGENT_CARD_ROUTE, chunkZ5EVXSXL_cjs.AGENT_EXECUTION_ROUTE];

// src/server/server-adapter/routes/agent-builder.ts
var AGENT_BUILDER_ROUTES = [
  chunkPLW5CELE_cjs.LIST_AGENT_BUILDER_ACTIONS_ROUTE,
  chunkPLW5CELE_cjs.GET_AGENT_BUILDER_ACTION_BY_ID_ROUTE,
  chunkPLW5CELE_cjs.LIST_AGENT_BUILDER_ACTION_RUNS_ROUTE,
  chunkPLW5CELE_cjs.GET_AGENT_BUILDER_ACTION_RUN_BY_ID_ROUTE,
  chunkPLW5CELE_cjs.CREATE_AGENT_BUILDER_ACTION_RUN_ROUTE,
  chunkPLW5CELE_cjs.STREAM_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.START_ASYNC_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.START_AGENT_BUILDER_ACTION_RUN_ROUTE,
  chunkPLW5CELE_cjs.OBSERVE_STREAM_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.RESUME_ASYNC_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.RESUME_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.RESUME_STREAM_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.CANCEL_AGENT_BUILDER_ACTION_RUN_ROUTE
];

// src/server/server-adapter/routes/agents.ts
var AGENTS_ROUTES = [
  // ============================================================================
  // Agent Core Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.LIST_AGENTS_ROUTE,
  chunk5JH2BJPC_cjs.GET_PROVIDERS_ROUTE,
  chunk5JH2BJPC_cjs.GET_AGENT_BY_ID_ROUTE,
  chunk5JH2BJPC_cjs.CLONE_AGENT_ROUTE,
  // ============================================================================
  // Voice Routes
  // ============================================================================
  chunkRP44EZSX_cjs.GET_SPEAKERS_ROUTE,
  chunkRP44EZSX_cjs.GET_SPEAKERS_DEPRECATED_ROUTE,
  // ============================================================================
  // Agent Execution Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.GENERATE_AGENT_ROUTE,
  chunk5JH2BJPC_cjs.GENERATE_AGENT_VNEXT_ROUTE,
  chunk5JH2BJPC_cjs.STREAM_GENERATE_ROUTE,
  chunk5JH2BJPC_cjs.STREAM_GENERATE_VNEXT_DEPRECATED_ROUTE,
  // ============================================================================
  // Tool Routes
  // ============================================================================
  chunkRU5PL7RD_cjs.EXECUTE_AGENT_TOOL_ROUTE,
  chunk5JH2BJPC_cjs.APPROVE_TOOL_CALL_ROUTE,
  chunk5JH2BJPC_cjs.DECLINE_TOOL_CALL_ROUTE,
  chunk5JH2BJPC_cjs.APPROVE_TOOL_CALL_GENERATE_ROUTE,
  chunk5JH2BJPC_cjs.DECLINE_TOOL_CALL_GENERATE_ROUTE,
  chunk5JH2BJPC_cjs.APPROVE_NETWORK_TOOL_CALL_ROUTE,
  chunk5JH2BJPC_cjs.DECLINE_NETWORK_TOOL_CALL_ROUTE,
  // ============================================================================
  // Network Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.STREAM_NETWORK_ROUTE,
  // ============================================================================
  // Model Management Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.UPDATE_AGENT_MODEL_ROUTE,
  chunk5JH2BJPC_cjs.RESET_AGENT_MODEL_ROUTE,
  chunk5JH2BJPC_cjs.REORDER_AGENT_MODEL_LIST_ROUTE,
  chunk5JH2BJPC_cjs.UPDATE_AGENT_MODEL_IN_MODEL_LIST_ROUTE,
  // ============================================================================
  // Instruction Enhancement Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.ENHANCE_INSTRUCTIONS_ROUTE,
  // ============================================================================
  // Agent Tool Routes
  // ============================================================================
  chunkRU5PL7RD_cjs.GET_AGENT_TOOL_ROUTE,
  // ============================================================================
  // Agent Skill Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.GET_AGENT_SKILL_ROUTE,
  // ============================================================================
  // Voice/Speech Routes
  // ============================================================================
  chunkRP44EZSX_cjs.GENERATE_SPEECH_ROUTE,
  chunkRP44EZSX_cjs.GENERATE_SPEECH_DEPRECATED_ROUTE,
  chunkRP44EZSX_cjs.TRANSCRIBE_SPEECH_ROUTE,
  chunkRP44EZSX_cjs.TRANSCRIBE_SPEECH_DEPRECATED_ROUTE,
  chunkRP44EZSX_cjs.GET_LISTENER_ROUTE,
  // ============================================================================
  // Deprecated Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.STREAM_VNEXT_DEPRECATED_ROUTE,
  chunk5JH2BJPC_cjs.STREAM_UI_MESSAGE_VNEXT_DEPRECATED_ROUTE,
  chunk5JH2BJPC_cjs.STREAM_UI_MESSAGE_DEPRECATED_ROUTE
];

// src/server/server-adapter/routes/datasets.ts
var DATASETS_ROUTES = [
  // Dataset CRUD
  chunkYNYUGFB5_cjs.LIST_DATASETS_ROUTE,
  chunkYNYUGFB5_cjs.CREATE_DATASET_ROUTE,
  chunkYNYUGFB5_cjs.GET_DATASET_ROUTE,
  chunkYNYUGFB5_cjs.UPDATE_DATASET_ROUTE,
  chunkYNYUGFB5_cjs.DELETE_DATASET_ROUTE,
  // Item list and add
  chunkYNYUGFB5_cjs.LIST_ITEMS_ROUTE,
  chunkYNYUGFB5_cjs.ADD_ITEM_ROUTE,
  // Batch operations - MUST come before item-specific routes to avoid /items/batch matching /items/:itemId
  chunkYNYUGFB5_cjs.BATCH_INSERT_ITEMS_ROUTE,
  chunkYNYUGFB5_cjs.BATCH_DELETE_ITEMS_ROUTE,
  // Item-specific CRUD (uses :itemId param)
  chunkYNYUGFB5_cjs.GET_ITEM_ROUTE,
  chunkYNYUGFB5_cjs.UPDATE_ITEM_ROUTE,
  chunkYNYUGFB5_cjs.DELETE_ITEM_ROUTE,
  // Version operations
  chunkYNYUGFB5_cjs.LIST_DATASET_VERSIONS_ROUTE,
  chunkYNYUGFB5_cjs.LIST_ITEM_VERSIONS_ROUTE,
  chunkYNYUGFB5_cjs.GET_ITEM_VERSION_ROUTE,
  // Experiment operations
  chunkYNYUGFB5_cjs.LIST_EXPERIMENTS_ROUTE,
  chunkYNYUGFB5_cjs.TRIGGER_EXPERIMENT_ROUTE,
  chunkYNYUGFB5_cjs.GET_EXPERIMENT_ROUTE,
  chunkYNYUGFB5_cjs.LIST_EXPERIMENT_RESULTS_ROUTE,
  // Analytics
  chunkYNYUGFB5_cjs.COMPARE_EXPERIMENTS_ROUTE
];

// src/server/server-adapter/routes/legacy.ts
var LEGACY_ROUTES = [
  // ============================================================================
  // Legacy Agent Routes
  // ============================================================================
  chunk5JH2BJPC_cjs.GENERATE_LEGACY_ROUTE,
  chunk5JH2BJPC_cjs.STREAM_GENERATE_LEGACY_ROUTE,
  // ============================================================================
  // Legacy Workflow Routes
  // ============================================================================
  chunkG2W3A4FZ_cjs.STREAM_LEGACY_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.OBSERVE_STREAM_LEGACY_WORKFLOW_ROUTE,
  // ============================================================================
  // Legacy Agent Builder Routes
  // ============================================================================
  chunkPLW5CELE_cjs.STREAM_LEGACY_AGENT_BUILDER_ACTION_ROUTE,
  chunkPLW5CELE_cjs.OBSERVE_STREAM_LEGACY_AGENT_BUILDER_ACTION_ROUTE
];

// src/server/server-adapter/routes/logs.ts
var LOGS_ROUTES = [
  chunkCFW3KNV7_cjs.LIST_LOG_TRANSPORTS_ROUTE,
  chunkCFW3KNV7_cjs.LIST_LOGS_ROUTE,
  chunkCFW3KNV7_cjs.LIST_LOGS_BY_RUN_ID_ROUTE
];

// src/server/server-adapter/routes/mcp.ts
var MCP_ROUTES = [
  // ============================================================================
  // MCP Server Registry Routes
  // ============================================================================
  chunk5LNN2GWK_cjs.LIST_MCP_SERVERS_ROUTE,
  chunk5LNN2GWK_cjs.GET_MCP_SERVER_DETAIL_ROUTE,
  // ============================================================================
  // MCP Server Tool Routes
  // ============================================================================
  chunk5LNN2GWK_cjs.LIST_MCP_SERVER_TOOLS_ROUTE,
  chunk5LNN2GWK_cjs.GET_MCP_SERVER_TOOL_DETAIL_ROUTE,
  chunk5LNN2GWK_cjs.EXECUTE_MCP_SERVER_TOOL_ROUTE,
  // ============================================================================
  // MCP Transport Routes (handled by adapters)
  // ============================================================================
  chunk5LNN2GWK_cjs.MCP_HTTP_TRANSPORT_ROUTE,
  chunk5LNN2GWK_cjs.MCP_SSE_TRANSPORT_ROUTE,
  chunk5LNN2GWK_cjs.MCP_SSE_MESSAGES_ROUTE
];

// src/server/server-adapter/routes/memory.ts
var MEMORY_ROUTES = [
  chunkUXMTV44Q_cjs.GET_MEMORY_STATUS_ROUTE,
  chunkUXMTV44Q_cjs.GET_MEMORY_CONFIG_ROUTE,
  chunkUXMTV44Q_cjs.GET_OBSERVATIONAL_MEMORY_ROUTE,
  chunkUXMTV44Q_cjs.AWAIT_BUFFER_STATUS_ROUTE,
  chunkUXMTV44Q_cjs.LIST_THREADS_ROUTE,
  chunkUXMTV44Q_cjs.GET_THREAD_BY_ID_ROUTE,
  chunkUXMTV44Q_cjs.LIST_MESSAGES_ROUTE,
  chunkUXMTV44Q_cjs.GET_WORKING_MEMORY_ROUTE,
  chunkUXMTV44Q_cjs.SAVE_MESSAGES_ROUTE,
  chunkUXMTV44Q_cjs.CREATE_THREAD_ROUTE,
  chunkUXMTV44Q_cjs.UPDATE_THREAD_ROUTE,
  chunkUXMTV44Q_cjs.DELETE_THREAD_ROUTE,
  chunkUXMTV44Q_cjs.CLONE_THREAD_ROUTE,
  chunkUXMTV44Q_cjs.UPDATE_WORKING_MEMORY_ROUTE,
  chunkUXMTV44Q_cjs.DELETE_MESSAGES_ROUTE,
  chunkUXMTV44Q_cjs.SEARCH_MEMORY_ROUTE,
  chunkUXMTV44Q_cjs.GET_MEMORY_STATUS_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.LIST_THREADS_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.GET_THREAD_BY_ID_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.LIST_MESSAGES_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.SAVE_MESSAGES_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.CREATE_THREAD_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.UPDATE_THREAD_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.DELETE_THREAD_NETWORK_ROUTE,
  chunkUXMTV44Q_cjs.DELETE_MESSAGES_NETWORK_ROUTE
];

// src/server/server-adapter/routes/observability.ts
var OBSERVABILITY_ROUTES = [
  chunkAV3VZ6S3_cjs.LIST_TRACES_ROUTE,
  chunkAV3VZ6S3_cjs.GET_TRACE_ROUTE,
  chunkAV3VZ6S3_cjs.SCORE_TRACES_ROUTE,
  chunkAV3VZ6S3_cjs.LIST_SCORES_BY_SPAN_ROUTE
];

// src/server/server-adapter/routes/processor-providers.ts
var PROCESSOR_PROVIDER_ROUTES = [
  chunkPUHV6FJA_cjs.LIST_PROCESSOR_PROVIDERS_ROUTE,
  chunkPUHV6FJA_cjs.GET_PROCESSOR_PROVIDER_ROUTE
];

// src/server/server-adapter/routes/processors.ts
var PROCESSORS_ROUTES = [
  chunkKPDZYFEE_cjs.LIST_PROCESSORS_ROUTE,
  chunkKPDZYFEE_cjs.GET_PROCESSOR_BY_ID_ROUTE,
  chunkKPDZYFEE_cjs.EXECUTE_PROCESSOR_ROUTE
];

// src/server/server-adapter/routes/scorers.ts
var SCORES_ROUTES = [
  chunk2XI7ZVGF_cjs.LIST_SCORERS_ROUTE,
  chunk2XI7ZVGF_cjs.GET_SCORER_ROUTE,
  chunk2XI7ZVGF_cjs.LIST_SCORES_BY_RUN_ID_ROUTE,
  chunk2XI7ZVGF_cjs.LIST_SCORES_BY_SCORER_ID_ROUTE,
  chunk2XI7ZVGF_cjs.LIST_SCORES_BY_ENTITY_ID_ROUTE,
  chunk2XI7ZVGF_cjs.SAVE_SCORE_ROUTE
];

// src/server/server-adapter/routes/stored-agents.ts
var STORED_AGENTS_ROUTES = [
  // ============================================================================
  // Stored Agents CRUD Routes
  // IMPORTANT: Routes with literal paths (e.g., /preview-instructions) must come
  // BEFORE routes with path parameters (e.g., /:storedAgentId) to ensure correct matching.
  // ============================================================================
  chunk2TI7W63K_cjs.LIST_STORED_AGENTS_ROUTE,
  chunk2TI7W63K_cjs.PREVIEW_INSTRUCTIONS_ROUTE,
  // Must be before GET_STORED_AGENT_ROUTE
  chunk2TI7W63K_cjs.GET_STORED_AGENT_ROUTE,
  chunk2TI7W63K_cjs.CREATE_STORED_AGENT_ROUTE,
  chunk2TI7W63K_cjs.UPDATE_STORED_AGENT_ROUTE,
  chunk2TI7W63K_cjs.DELETE_STORED_AGENT_ROUTE,
  // ============================================================================
  // Agent Versions Routes
  // IMPORTANT: Routes with literal paths (e.g., /compare) must come BEFORE
  // routes with path parameters (e.g., /:versionId) to ensure correct matching.
  // ============================================================================
  chunkSY6MLMJF_cjs.LIST_AGENT_VERSIONS_ROUTE,
  chunkSY6MLMJF_cjs.CREATE_AGENT_VERSION_ROUTE,
  chunkSY6MLMJF_cjs.COMPARE_AGENT_VERSIONS_ROUTE,
  // Must be before GET_AGENT_VERSION_ROUTE
  chunkSY6MLMJF_cjs.GET_AGENT_VERSION_ROUTE,
  chunkSY6MLMJF_cjs.ACTIVATE_AGENT_VERSION_ROUTE,
  chunkSY6MLMJF_cjs.RESTORE_AGENT_VERSION_ROUTE,
  chunkSY6MLMJF_cjs.DELETE_AGENT_VERSION_ROUTE
];

// src/server/server-adapter/routes/stored-mcp-clients.ts
var STORED_MCP_CLIENTS_ROUTES = [
  // Stored MCP Clients CRUD Routes
  chunkEHZ4BAYY_cjs.LIST_STORED_MCP_CLIENTS_ROUTE,
  chunkEHZ4BAYY_cjs.GET_STORED_MCP_CLIENT_ROUTE,
  chunkEHZ4BAYY_cjs.CREATE_STORED_MCP_CLIENT_ROUTE,
  chunkEHZ4BAYY_cjs.UPDATE_STORED_MCP_CLIENT_ROUTE,
  chunkEHZ4BAYY_cjs.DELETE_STORED_MCP_CLIENT_ROUTE,
  // MCP Client Versions Routes
  // IMPORTANT: Routes with literal paths (e.g., /compare) must come BEFORE
  // routes with path parameters (e.g., /:versionId) to ensure correct matching.
  chunkBD254TQA_cjs.LIST_MCP_CLIENT_VERSIONS_ROUTE,
  chunkBD254TQA_cjs.CREATE_MCP_CLIENT_VERSION_ROUTE,
  chunkBD254TQA_cjs.COMPARE_MCP_CLIENT_VERSIONS_ROUTE,
  chunkBD254TQA_cjs.GET_MCP_CLIENT_VERSION_ROUTE,
  chunkBD254TQA_cjs.ACTIVATE_MCP_CLIENT_VERSION_ROUTE,
  chunkBD254TQA_cjs.RESTORE_MCP_CLIENT_VERSION_ROUTE,
  chunkBD254TQA_cjs.DELETE_MCP_CLIENT_VERSION_ROUTE
];

// src/server/server-adapter/routes/stored-prompt-blocks.ts
var STORED_PROMPT_BLOCKS_ROUTES = [
  // Stored Prompt Blocks CRUD Routes
  chunkMJLQLQ6K_cjs.LIST_STORED_PROMPT_BLOCKS_ROUTE,
  chunkMJLQLQ6K_cjs.GET_STORED_PROMPT_BLOCK_ROUTE,
  chunkMJLQLQ6K_cjs.CREATE_STORED_PROMPT_BLOCK_ROUTE,
  chunkMJLQLQ6K_cjs.UPDATE_STORED_PROMPT_BLOCK_ROUTE,
  chunkMJLQLQ6K_cjs.DELETE_STORED_PROMPT_BLOCK_ROUTE,
  // Prompt Block Versions Routes
  // IMPORTANT: Routes with literal paths (e.g., /compare) must come BEFORE
  // routes with path parameters (e.g., /:versionId) to ensure correct matching.
  chunkZE4IJKQD_cjs.LIST_PROMPT_BLOCK_VERSIONS_ROUTE,
  chunkZE4IJKQD_cjs.CREATE_PROMPT_BLOCK_VERSION_ROUTE,
  chunkZE4IJKQD_cjs.COMPARE_PROMPT_BLOCK_VERSIONS_ROUTE,
  chunkZE4IJKQD_cjs.GET_PROMPT_BLOCK_VERSION_ROUTE,
  chunkZE4IJKQD_cjs.ACTIVATE_PROMPT_BLOCK_VERSION_ROUTE,
  chunkZE4IJKQD_cjs.RESTORE_PROMPT_BLOCK_VERSION_ROUTE,
  chunkZE4IJKQD_cjs.DELETE_PROMPT_BLOCK_VERSION_ROUTE
];

// src/server/server-adapter/routes/stored-scorers.ts
var STORED_SCORERS_ROUTES = [
  // Stored Scorers CRUD Routes
  chunkFOOBWL6U_cjs.LIST_STORED_SCORERS_ROUTE,
  chunkFOOBWL6U_cjs.GET_STORED_SCORER_ROUTE,
  chunkFOOBWL6U_cjs.CREATE_STORED_SCORER_ROUTE,
  chunkFOOBWL6U_cjs.UPDATE_STORED_SCORER_ROUTE,
  chunkFOOBWL6U_cjs.DELETE_STORED_SCORER_ROUTE,
  // Scorer Versions Routes
  // IMPORTANT: Routes with literal paths (e.g., /compare) must come BEFORE
  // routes with path parameters (e.g., /:versionId) to ensure correct matching.
  chunkICHZVTM6_cjs.LIST_SCORER_VERSIONS_ROUTE,
  chunkICHZVTM6_cjs.CREATE_SCORER_VERSION_ROUTE,
  chunkICHZVTM6_cjs.COMPARE_SCORER_VERSIONS_ROUTE,
  chunkICHZVTM6_cjs.GET_SCORER_VERSION_ROUTE,
  chunkICHZVTM6_cjs.ACTIVATE_SCORER_VERSION_ROUTE,
  chunkICHZVTM6_cjs.RESTORE_SCORER_VERSION_ROUTE,
  chunkICHZVTM6_cjs.DELETE_SCORER_VERSION_ROUTE
];

// src/server/server-adapter/routes/stored-skills.ts
var STORED_SKILLS_ROUTES = [
  // Stored Skills CRUD Routes
  chunkTZNUIMHF_cjs.LIST_STORED_SKILLS_ROUTE,
  chunkTZNUIMHF_cjs.GET_STORED_SKILL_ROUTE,
  chunkTZNUIMHF_cjs.CREATE_STORED_SKILL_ROUTE,
  chunkTZNUIMHF_cjs.UPDATE_STORED_SKILL_ROUTE,
  chunkTZNUIMHF_cjs.DELETE_STORED_SKILL_ROUTE,
  // Publish
  chunkTZNUIMHF_cjs.PUBLISH_STORED_SKILL_ROUTE
];

// src/server/server-adapter/routes/stored-workspaces.ts
var STORED_WORKSPACES_ROUTES = [
  // Stored Workspaces CRUD Routes
  chunk335CI24F_cjs.LIST_STORED_WORKSPACES_ROUTE,
  chunk335CI24F_cjs.GET_STORED_WORKSPACE_ROUTE,
  chunk335CI24F_cjs.CREATE_STORED_WORKSPACE_ROUTE,
  chunk335CI24F_cjs.UPDATE_STORED_WORKSPACE_ROUTE,
  chunk335CI24F_cjs.DELETE_STORED_WORKSPACE_ROUTE
];

// src/server/server-adapter/routes/system.ts
var SYSTEM_ROUTES = [chunkT5KH32UA_cjs.GET_SYSTEM_PACKAGES_ROUTE];

// src/server/server-adapter/routes/tool-providers.ts
var TOOL_PROVIDER_ROUTES = [
  chunkGHD37MZU_cjs.LIST_TOOL_PROVIDERS_ROUTE,
  chunkGHD37MZU_cjs.LIST_TOOL_PROVIDER_TOOLKITS_ROUTE,
  chunkGHD37MZU_cjs.LIST_TOOL_PROVIDER_TOOLS_ROUTE,
  chunkGHD37MZU_cjs.GET_TOOL_PROVIDER_TOOL_SCHEMA_ROUTE
];

// src/server/server-adapter/routes/tools.ts
var TOOLS_ROUTES = [chunkRU5PL7RD_cjs.LIST_TOOLS_ROUTE, chunkRU5PL7RD_cjs.GET_TOOL_BY_ID_ROUTE, chunkRU5PL7RD_cjs.EXECUTE_TOOL_ROUTE];

// src/server/server-adapter/routes/vectors.ts
var VECTORS_ROUTES = [
  chunkEHHCBPKQ_cjs.UPSERT_VECTORS_ROUTE,
  chunkEHHCBPKQ_cjs.CREATE_INDEX_ROUTE,
  chunkEHHCBPKQ_cjs.QUERY_VECTORS_ROUTE,
  chunkEHHCBPKQ_cjs.LIST_INDEXES_ROUTE,
  chunkEHHCBPKQ_cjs.DESCRIBE_INDEX_ROUTE,
  chunkEHHCBPKQ_cjs.DELETE_INDEX_ROUTE,
  chunkEHHCBPKQ_cjs.LIST_VECTORS_ROUTE,
  chunkEHHCBPKQ_cjs.LIST_EMBEDDERS_ROUTE
];

// src/server/server-adapter/routes/workflows.ts
var WORKFLOWS_ROUTES = [
  chunkG2W3A4FZ_cjs.LIST_WORKFLOWS_ROUTE,
  chunkG2W3A4FZ_cjs.GET_WORKFLOW_BY_ID_ROUTE,
  chunkG2W3A4FZ_cjs.LIST_WORKFLOW_RUNS_ROUTE,
  chunkG2W3A4FZ_cjs.GET_WORKFLOW_RUN_BY_ID_ROUTE,
  chunkG2W3A4FZ_cjs.DELETE_WORKFLOW_RUN_BY_ID_ROUTE,
  chunkG2W3A4FZ_cjs.CREATE_WORKFLOW_RUN_ROUTE,
  chunkG2W3A4FZ_cjs.STREAM_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESUME_STREAM_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.START_ASYNC_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.START_WORKFLOW_RUN_ROUTE,
  chunkG2W3A4FZ_cjs.OBSERVE_STREAM_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESUME_ASYNC_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESUME_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.CANCEL_WORKFLOW_RUN_ROUTE,
  chunkG2W3A4FZ_cjs.TIME_TRAVEL_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.TIME_TRAVEL_ASYNC_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.TIME_TRAVEL_STREAM_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESTART_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESTART_ASYNC_WORKFLOW_ROUTE,
  chunkG2W3A4FZ_cjs.RESTART_ALL_ACTIVE_WORKFLOW_RUNS_ROUTE,
  chunkG2W3A4FZ_cjs.RESTART_ALL_ACTIVE_WORKFLOW_RUNS_ASYNC_ROUTE
];

// src/server/server-adapter/routes/workspace.ts
var WORKSPACE_ROUTES = [
  // List all workspaces route (at /api/workspaces)
  chunk6OM4GWXC_cjs.LIST_WORKSPACES_ROUTE,
  // Get workspace route (at /api/workspaces/:workspaceId)
  chunk6OM4GWXC_cjs.GET_WORKSPACE_ROUTE,
  // Filesystem routes (at /api/workspaces/:workspaceId/fs/*)
  ...chunk6OM4GWXC_cjs.WORKSPACE_FS_ROUTES,
  // Search routes (at /api/workspaces/:workspaceId/search, /api/workspaces/:workspaceId/index)
  ...chunk6OM4GWXC_cjs.WORKSPACE_SEARCH_ROUTES,
  // Skills routes (search must come before parameterized routes)
  ...chunk6OM4GWXC_cjs.WORKSPACE_SKILLS_ROUTES,
  // skills.sh proxy routes (at /api/workspaces/:workspaceId/skills-sh/*)
  ...chunk6OM4GWXC_cjs.WORKSPACE_SKILLS_SH_ROUTES
];

// src/server/server-adapter/routes/index.ts
var SERVER_ROUTES = [
  ...AGENTS_ROUTES,
  ...WORKFLOWS_ROUTES,
  ...TOOLS_ROUTES,
  ...PROCESSORS_ROUTES,
  ...MEMORY_ROUTES,
  ...SCORES_ROUTES,
  ...OBSERVABILITY_ROUTES,
  ...LOGS_ROUTES,
  ...VECTORS_ROUTES,
  ...A2A_ROUTES,
  ...AGENT_BUILDER_ROUTES,
  ...WORKSPACE_ROUTES,
  ...LEGACY_ROUTES,
  ...MCP_ROUTES,
  ...STORED_AGENTS_ROUTES,
  ...STORED_MCP_CLIENTS_ROUTES,
  ...STORED_PROMPT_BLOCKS_ROUTES,
  ...STORED_SCORERS_ROUTES,
  ...STORED_WORKSPACES_ROUTES,
  ...STORED_SKILLS_ROUTES,
  ...TOOL_PROVIDER_ROUTES,
  ...PROCESSOR_PROVIDER_ROUTES,
  ...SYSTEM_ROUTES,
  ...DATASETS_ROUTES
];

// src/server/server-adapter/redact.ts
function redactV2Payload(payload) {
  const redactedPayload = { ...payload };
  if (redactedPayload.metadata && typeof redactedPayload.metadata === "object") {
    const { request, ...metadataRest } = redactedPayload.metadata;
    redactedPayload.metadata = metadataRest;
  }
  if (redactedPayload.output && typeof redactedPayload.output === "object") {
    const output = { ...redactedPayload.output };
    if (Array.isArray(output.steps)) {
      output.steps = output.steps.map((step) => {
        if (step && typeof step === "object") {
          const { request, ...stepRest } = step;
          return stepRest;
        }
        return step;
      });
    }
    redactedPayload.output = output;
  }
  return redactedPayload;
}
function redactStreamChunk(chunk) {
  if (!chunk || typeof chunk !== "object") {
    return chunk;
  }
  const typedChunk = chunk;
  switch (chunk.type) {
    case "step-start": {
      if ("payload" in typedChunk && typedChunk.payload && typeof typedChunk.payload === "object") {
        const { payload, ...rest } = typedChunk;
        const { request, ...payloadRest } = payload;
        return {
          ...rest,
          type: "step-start",
          payload: {
            ...payloadRest,
            // Keep an empty request object to maintain structure but remove body
            request: {}
          }
        };
      } else if ("request" in typedChunk) {
        const { request, ...rest } = typedChunk;
        return {
          ...rest,
          type: "step-start",
          // Keep an empty request object to maintain structure
          request: {}
        };
      }
      return chunk;
    }
    case "step-finish": {
      if ("payload" in typedChunk && typedChunk.payload && typeof typedChunk.payload === "object") {
        const { payload, ...rest } = typedChunk;
        return {
          ...rest,
          type: "step-finish",
          payload: redactV2Payload(payload)
        };
      } else if ("request" in typedChunk) {
        const { request, ...rest } = typedChunk;
        return {
          ...rest,
          type: "step-finish"
        };
      }
      return chunk;
    }
    case "finish": {
      if ("payload" in typedChunk && typedChunk.payload && typeof typedChunk.payload === "object") {
        const { payload, ...rest } = typedChunk;
        return {
          ...rest,
          type: "finish",
          payload: redactV2Payload(payload)
        };
      } else if ("request" in typedChunk) {
        const { request, ...rest } = typedChunk;
        return {
          ...rest,
          type: "finish"
        };
      }
      return chunk;
    }
    default:
      return chunk;
  }
}

// src/server/server-adapter/index.ts
function normalizeQueryParams(rawQuery) {
  const queryParams = {};
  const bracketGroups = {};
  for (const [key, value] of Object.entries(rawQuery)) {
    const bracketMatch = key.match(/^([^[]+)\[([^\]]+)\]$/);
    if (bracketMatch) {
      const parent = bracketMatch[1];
      const child = bracketMatch[2];
      const strValue = Array.isArray(value) ? value.filter((v) => typeof v === "string")[0] : typeof value === "string" ? value : void 0;
      if (strValue !== void 0) {
        if (!bracketGroups[parent]) {
          bracketGroups[parent] = {};
        }
        bracketGroups[parent][child] = strValue;
      }
    } else if (typeof value === "string") {
      queryParams[key] = value;
    } else if (Array.isArray(value)) {
      const stringValues = value.filter((v) => typeof v === "string");
      queryParams[key] = stringValues.length === 1 ? stringValues[0] : stringValues;
    }
  }
  for (const [parent, children] of Object.entries(bracketGroups)) {
    if (!(parent in queryParams)) {
      queryParams[parent] = JSON.stringify(children);
    }
  }
  return queryParams;
}
var MastraServer = class extends server.MastraServerBase {
  mastra;
  bodyLimitOptions;
  tools;
  prefix;
  openapiPath;
  taskStore;
  customRouteAuthConfig;
  streamOptions;
  customApiRoutes;
  mcpOptions;
  customRouteHandler = null;
  constructor({
    app,
    mastra,
    bodyLimitOptions,
    tools,
    prefix = "/api",
    openapiPath = "",
    taskStore,
    customRouteAuthConfig,
    streamOptions,
    customApiRoutes,
    mcpOptions
  }) {
    super({ app, name: "MastraServer" });
    this.mastra = mastra;
    this.bodyLimitOptions = bodyLimitOptions;
    this.tools = tools;
    this.prefix = chunkHHE6BWUK_cjs.normalizeRoutePath(prefix);
    this.openapiPath = openapiPath;
    this.taskStore = taskStore;
    this.customRouteAuthConfig = customRouteAuthConfig;
    this.streamOptions = { redact: true, ...streamOptions };
    this.customApiRoutes = customApiRoutes;
    this.mcpOptions = mcpOptions;
    mastra.setMastraServer(this);
  }
  mergeRequestContext({
    paramsRequestContext,
    bodyRequestContext
  }) {
    const requestContext$1 = new requestContext.RequestContext();
    if (bodyRequestContext) {
      for (const [key, value] of Object.entries(bodyRequestContext)) {
        requestContext$1.set(key, value);
      }
    }
    if (paramsRequestContext) {
      for (const [key, value] of Object.entries(paramsRequestContext)) {
        requestContext$1.set(key, value);
      }
    }
    return requestContext$1;
  }
  /**
   * Check if the current request should be authenticated/authorized.
   * Returns null if auth passes, or an error response if it fails.
   *
   * This method encapsulates the complete auth flow:
   * 1. Check if route requires auth (route.requiresAuth)
   * 2. Check if it's a dev playground request
   * 3. Check if path is publicly accessible
   * 4. Perform authentication (verify token)
   * 5. Perform authorization (check rules, authorizeUser, authorize)
   */
  async checkRouteAuth(route, context) {
    const authConfig = this.mastra.getServer()?.auth;
    if (!authConfig) {
      return null;
    }
    if (route.requiresAuth === false) {
      return null;
    }
    if (chunkAAHPYUEC_cjs.isDevPlaygroundRequest(context.path, context.method, context.getHeader, authConfig)) {
      return null;
    }
    if (chunkAAHPYUEC_cjs.canAccessPublicly(context.path, context.method, authConfig)) {
      return null;
    }
    const authHeader = context.getHeader("authorization");
    let token = authHeader ? authHeader.replace("Bearer ", "") : null;
    if (!token) {
      token = context.getQuery("apiKey") || null;
    }
    if (!token) {
      return { status: 401, error: "Authentication required" };
    }
    let user;
    try {
      if (typeof authConfig.authenticateToken === "function") {
        user = await authConfig.authenticateToken(token, null);
      } else {
        return { status: 401, error: "No token verification method configured" };
      }
      if (!user) {
        return { status: 401, error: "Invalid or expired token" };
      }
      context.requestContext.set("user", user);
    } catch (err) {
      this.mastra.getLogger()?.error("Authentication error", {
        error: err instanceof Error ? { message: err.message, stack: err.stack } : err
      });
      return { status: 401, error: "Invalid or expired token" };
    }
    if ("authorizeUser" in authConfig && typeof authConfig.authorizeUser === "function") {
      try {
        const isAuthorized = await authConfig.authorizeUser(user, null);
        if (!isAuthorized) {
          return { status: 403, error: "Access denied" };
        }
        return null;
      } catch (err) {
        this.mastra.getLogger()?.error("Authorization error in authorizeUser", {
          error: err instanceof Error ? { message: err.message, stack: err.stack } : err
        });
        return { status: 500, error: "Authorization error" };
      }
    }
    if ("authorize" in authConfig && typeof authConfig.authorize === "function") {
      try {
        const isAuthorized = await authConfig.authorize(context.path, context.method, user, null);
        if (!isAuthorized) {
          return { status: 403, error: "Access denied" };
        }
        return null;
      } catch (err) {
        this.mastra.getLogger()?.error("Authorization error in authorize", {
          error: err instanceof Error ? { message: err.message, stack: err.stack } : err,
          path: context.path,
          method: context.method
        });
        return { status: 500, error: "Authorization error" };
      }
    }
    if ("rules" in authConfig && authConfig.rules && authConfig.rules.length > 0) {
      const isAuthorized = await chunkAAHPYUEC_cjs.checkRules(authConfig.rules, context.path, context.method, user);
      if (isAuthorized) {
        return null;
      }
      return { status: 403, error: "Access denied" };
    }
    if (chunkAAHPYUEC_cjs.defaultAuthConfig.rules && chunkAAHPYUEC_cjs.defaultAuthConfig.rules.length > 0) {
      const isAuthorized = await chunkAAHPYUEC_cjs.checkRules(chunkAAHPYUEC_cjs.defaultAuthConfig.rules, context.path, context.method, user);
      if (isAuthorized) {
        return null;
      }
    }
    return { status: 403, error: "Access denied" };
  }
  async init() {
    this.registerContextMiddleware();
    this.registerAuthMiddleware();
    await this.registerCustomApiRoutes();
    await this.registerRoutes();
  }
  /**
   * Override in adapters to register custom API routes defined via registerApiRoute().
   * Called by init() between registerAuthMiddleware() and registerRoutes().
   */
  async registerCustomApiRoutes() {
  }
  /**
   * Creates an internal Hono sub-app with all custom API routes registered.
   * Stores the handler on this instance for use by handleCustomRouteRequest().
   * Returns true if custom routes were found and registered.
   */
  async buildCustomRouteHandler() {
    const routes = this.customApiRoutes ?? this.mastra.getServer()?.apiRoutes;
    if (!routes || routes.length === 0) return false;
    const NOT_FOUND_HEADER = "x-mastra-custom-route-not-found";
    const mastra = this.mastra;
    const app = new hono.Hono();
    app.use("*", async (c, next) => {
      c.set("mastra", mastra);
      c.set("requestContext", c.env?.requestContext ?? new requestContext.RequestContext());
      await next();
    });
    for (const route of routes) {
      const handler = "handler" in route && route.handler ? route.handler : "createHandler" in route ? await route.createHandler({ mastra }) : void 0;
      if (!handler) continue;
      const middlewares = [];
      if (route.middleware) {
        middlewares.push(...Array.isArray(route.middleware) ? route.middleware : [route.middleware]);
      }
      const allHandlers = [...middlewares, handler];
      if (route.method === "ALL") {
        app.all(route.path, allHandlers[0], ...allHandlers.slice(1));
      } else {
        app.on(route.method, route.path, allHandlers[0], ...allHandlers.slice(1));
      }
    }
    app.notFound(() => new Response(null, { status: 404, headers: { [NOT_FOUND_HEADER]: "true" } }));
    this.customRouteHandler = async (request, env) => app.fetch(request, env);
    return true;
  }
  /**
   * Forwards a request to the internal custom route handler.
   * Returns the Response if a custom route matched, or null to fall through.
   * Used by non-Hono adapter bridges.
   */
  async handleCustomRouteRequest(url, method, headers, body, requestContext) {
    if (!this.customRouteHandler) return null;
    const fetchHeaders = new Headers();
    for (const [key, value] of Object.entries(headers)) {
      if (typeof value === "string") fetchHeaders.set(key, value);
      else if (Array.isArray(value))
        value.forEach((v) => {
          fetchHeaders.append(key, v);
        });
    }
    const init = { method, headers: fetchHeaders };
    if (["POST", "PUT", "PATCH"].includes(method) && body !== void 0) {
      const contentType = (typeof headers["content-type"] === "string" ? headers["content-type"] : "") || "";
      if (contentType.includes("application/json")) {
        init.body = JSON.stringify(body);
      } else if (typeof body === "string") {
        init.body = body;
      } else if (body instanceof ArrayBuffer || body instanceof Uint8Array || body instanceof ReadableStream) {
        init.body = body;
      }
    }
    const request = new globalThis.Request(url, init);
    const response = await this.customRouteHandler(request, { requestContext });
    if (response.headers.get("x-mastra-custom-route-not-found") === "true") return null;
    return response;
  }
  /**
   * Pipes a custom route Response to a Node.js ServerResponse (http.ServerResponse).
   * Works with Koa (ctx.res), Express (res), and Fastify (reply.raw).
   */
  async writeCustomRouteResponse(response, nodeRes) {
    const headers = {};
    response.headers.forEach((value, key) => {
      if (key.toLowerCase() !== "set-cookie") {
        headers[key] = value;
      }
    });
    const setCookies = response.headers.getSetCookie?.();
    if (setCookies && setCookies.length > 0) {
      headers["set-cookie"] = setCookies;
    }
    nodeRes.writeHead(response.status, headers);
    if (response.body) {
      const reader = response.body.getReader();
      try {
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          nodeRes.write(value);
        }
      } finally {
        nodeRes.end();
      }
    } else {
      nodeRes.end(await response.text());
    }
  }
  async registerOpenAPIRoute(app, config = {}, { prefix }) {
    const {
      title = "Mastra API",
      version = "1.0.0",
      description = "Mastra Server API",
      path = "/openapi.json"
    } = config;
    const openApiSpec = chunk4LVJBXI2_cjs.generateOpenAPIDocument(SERVER_ROUTES, {
      title,
      version,
      description
    });
    if (prefix) {
      openApiSpec.servers = [{ url: prefix }];
    }
    if (this.customApiRoutes && this.customApiRoutes.length > 0) {
      const customPaths = chunk4LVJBXI2_cjs.convertCustomRoutesToOpenAPIPaths(this.customApiRoutes);
      openApiSpec.paths = { ...openApiSpec.paths, ...customPaths };
    }
    const openApiRoute = {
      method: "GET",
      path,
      responseType: "json",
      handler: async () => openApiSpec
    };
    await this.registerRoute(app, openApiRoute, { prefix });
  }
  async registerRoutes() {
    for (const route of SERVER_ROUTES) {
      await this.registerRoute(this.app, route, { prefix: this.prefix });
    }
    if (this.openapiPath) {
      await this.registerOpenAPIRoute(
        this.app,
        {
          title: "Mastra API",
          version: "1.0.0",
          description: "Mastra Server API",
          path: this.openapiPath
        },
        { prefix: this.prefix }
      );
    }
  }
  async parsePathParams(route, params) {
    const pathParamSchema = route.pathParamSchema;
    if (!pathParamSchema) {
      return params;
    }
    return pathParamSchema.parseAsync(params);
  }
  async parseQueryParams(route, params) {
    const queryParamSchema = route.queryParamSchema;
    if (!queryParamSchema) {
      return params;
    }
    return queryParamSchema.parseAsync(params);
  }
  async parseBody(route, body) {
    const bodySchema = route.bodySchema;
    if (!bodySchema) {
      return body;
    }
    return bodySchema.parseAsync(body);
  }
};

Object.defineProperty(exports, "WorkflowRegistry", {
  enumerable: true,
  get: function () { return chunkHHE6BWUK_cjs.WorkflowRegistry; }
});
Object.defineProperty(exports, "normalizeRoutePath", {
  enumerable: true,
  get: function () { return chunkHHE6BWUK_cjs.normalizeRoutePath; }
});
Object.defineProperty(exports, "createRoute", {
  enumerable: true,
  get: function () { return chunk4LVJBXI2_cjs.createRoute; }
});
Object.defineProperty(exports, "generateOpenAPIDocument", {
  enumerable: true,
  get: function () { return chunk4LVJBXI2_cjs.generateOpenAPIDocument; }
});
Object.defineProperty(exports, "jsonQueryParam", {
  enumerable: true,
  get: function () { return chunk4LVJBXI2_cjs.jsonQueryParam; }
});
Object.defineProperty(exports, "pickParams", {
  enumerable: true,
  get: function () { return chunk4LVJBXI2_cjs.pickParams; }
});
Object.defineProperty(exports, "wrapSchemaForQueryParams", {
  enumerable: true,
  get: function () { return chunk4LVJBXI2_cjs.wrapSchemaForQueryParams; }
});
exports.MastraServer = MastraServer;
exports.SERVER_ROUTES = SERVER_ROUTES;
exports.normalizeQueryParams = normalizeQueryParams;
exports.redactStreamChunk = redactStreamChunk;
//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map